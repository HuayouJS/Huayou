/*
   * Huayou JavaScript library huayou.esm.min.js@v0.6.8 
   * [GitHub repository] http://github.com/huayoujs/huayou
   * [API Reference] https://huayoujs.github.io/huayou/docs/api/index.html
   * [Basic examples] https://huayoujs.github.io/huayou/examples/basic/index.html
   * [Email] <huayou-service@hotmail.com>
   * Original work Copyright (C) by Andrea Leofreddi (SVGPan) and bumbu(svg-pan-zoom)
   * Modified work Copyright (C) 2023 - present by HuayouJS (Huayou)
   * @license
   */

class e{static get(){return(new Date).toISOString().replace(/\D/g,"")}}class t{static camelCase(e){return e.toLowerCase().replace(/-(.)/g,(function(e,t){return t.toUpperCase()}))}static unCamelCase(e){return e.replace(/([A-Z])/g,(function(e,t){return"-"+t.toLowerCase()}))}static isBlank(e){return/^(\s+)?$/.test(e)}}let n=class{static style(e,n,i){const o={};if(1===arguments.length)return e.style.cssText.split(/\s*;\s*/).filter((function(e){return!!e.length})).forEach((function(e){const t=e.split(/\s*:\s*/);o[t[0]]=t[1]})),o;if(2===arguments.length){if(Array.isArray(n)){for(const i of n){const n=t.camelCase(i);o[i]=e.style[n]}return o}if("string"==typeof n)return e.style[t.camelCase(n)];if("object"==typeof n)for(const i in n)e.style[t.camelCase(i)]=null==n[i]||t.isBlank(n[i])?"":n[i]}3===arguments.length&&(e.style[t.camelCase(n)]=null==i||t.isBlank(i)?"":i)}static removeAttrs(e,t){let n="";return e.split(/\s*;\s*/).filter((function(e){return!!e.length})).forEach((function(e){const i=e.split(/\s*:\s*/);t.includes(i[0])||(n=n+";"+e)})),n}};const i="Huayou",o="http://www.w3.org/2000/svg",s="http://www.w3.org/2000/xmlns/",r="huayouCacheGraph",a="huayou",l="com.huayoujs.xsvg",h="_hyElemProxy",u=new class{prefix;namespaceURI;constructor(e,t){this.prefix=e,this.namespaceURI=t}}(a,l);class c{name;xmlns;constructor(e,t){this.name=e,this.xmlns=t}}class m extends c{value;constructor(e,t,n){super(e,n),this.value=t}}class p{is=new m("is","Metadata",u)}class d{is=new m("is","Style",u)}class f{is=new m("is","Defs",u)}class v{is=new m("is","Layers",u)}class g{is=new m("is","Layer",u);name=new c("name",u)}let _=new Set([u]),y=new class{metadata=new p;style=new d;defs=new f;layers=new v;layer=new g};class w extends Error{name;message;_msg;_at;cause;constructor(e,t=null,n=null){super(),this._msg=e,this._at=t,this.cause=n,this.name=`${i}.Error`,this.message=this._fullMsg()}_fullMsg(){let e;return e=null!==this._at?`Failed to execute '${i}.${this._at}': ${this._msg}`:this._msg,e}}class b{_array;constructor(){this._array=new Array}get size(){return this._array.length}add(e,t){1==arguments.length?this._array.push(e):2==arguments.length&&this._array.splice(t,0,e)}get(e){return this._array.at(e)}has(e){return this._array.includes(e)}indexOf(e){return this._array.indexOf(e)}remove(e){let t=this.indexOf(e);this._array.splice(t,1)}removeAt(e){this._array.splice(e,1)}keys(){return this._array.keys()}values(){return this._array.values()}entries(){return this._array.entries()}forEach(e,t){this._array.forEach(e,t)}}class x{static getAttrFrom(e,t){let n;return n=null!==t.xmlns?e.getAttribute(t.xmlns.prefix+":"+t.name):e.getAttribute(t.name),n}static setAttrTo(e,t,n){null!==t.xmlns?e.setAttribute(t.xmlns.prefix+":"+t.name,n):e.setAttribute(t.name,n)}static hasAttr(e,t){let n;return n=null!==t.xmlns?e.hasAttribute(t.xmlns.prefix+":"+t.name):e.hasAttribute(t.name),n}static removeAttr(e,t){null!==t.xmlns?e.removeAttribute(t.xmlns.prefix+":"+t.name):e.removeAttribute(t.name)}}class E extends w{name="";constructor(e,t=null,n=null){super(e,t,n),this.name=`${i}.SVGParserError`}}class S{_graph;_nativeNode;get viewer(){return this._graph.viewer}get graph(){return this._graph}get nativeNode(){return this._nativeNode}setGraph(e){this._graph=e}get children(){return Array.from(this.nativeNode.children)}get firstElementChild(){return this.nativeNode.firstElementChild}get lastElementChild(){return this.nativeNode.lastElementChild}get childNodes(){return Array.from(this.nativeNode.childNodes)}get firstChild(){return this.nativeNode.firstChild}get lastChild(){return this.nativeNode.lastChild}get innerHTML(){return this.nativeNode.innerHTML}set innerHTML(e){this.nativeNode.innerHTML=e}get outerHTML(){return this.nativeNode.outerHTML}get textContent(){return this.nativeNode.textContent}set textContent(e){this.nativeNode.textContent=e}appendChild(e){return this.nativeNode.appendChild(e)}removeChild(e){return this.nativeNode.removeChild(e)}insertBefore(e,t){return this.nativeNode.insertBefore(e,t)}insertAdjacentHTML(e,t){if("afterbegin"==e||"beforeend"==e)return this.nativeNode.insertAdjacentHTML(e,t);throw new w(" 'position' must be either 'afterbegin' or 'before'","Container.insertAdjacentHTML")}append(...e){this.nativeNode.append(...e)}prepend(...e){this.nativeNode.prepend(...e)}contains(e){return e!==this.nativeNode&&this.nativeNode.contains(e)}hasChildNodes(){return this.nativeNode.hasChildNodes()}replaceChild(e,t){return this.nativeNode.replaceChild(e,t)}querySelector(e){try{return this.nativeNode.querySelector(e)}catch(e){throw new w(e.message,"Container.querySelector")}}querySelectorAll(e){try{let t=this.nativeNode.querySelectorAll(e);return Array.from(t)}catch(e){throw new w(e.message,"Container.querySelectorAll")}}getElementsByTagName(e){let t=this.nativeNode.getElementsByTagName(e);return Array.from(t)}getElementsByClassName(e){let t=this.nativeNode.getElementsByClassName(e);return Array.from(t)}}class T extends S{_layers;_name;_visible=!0;constructor(e){super();let t=arguments.length;if(1!=t)throw new w(`1 argument required, but ${t} present.`,"BaseLayer.constructor");if("string"==typeof e){if(""==e.trim())throw new w("'name'  cannot be an empty string.","BaseLayer.constructor");this._constructor(e)}else{if(!(e instanceof SVGGElement))throw new w("argument must be of type string or SVGGElement .","BaseLayer.constructor");T._valid(e)&&this._constructor_el(e)}this._nativeNode[h]=this}_constructor(e){this._name=e,this._createNativeNode(e)}_constructor_el(e){let t=y.layer,n=x.getAttrFrom(e,t.name);this._name=n,this._nativeNode=e;let i=this._nativeNode.getAttribute("display");this._visible="none"!=i}_createNativeNode(e){let t=document.createElementNS(o,"g");x.setAttrTo(t,y.layer.is,y.layer.is.value),x.setAttrTo(t,y.layer.name,e),this._nativeNode=t,this._visible=!0}static _valid(e){try{if(!(e instanceof SVGGElement))throw new w("'element' must be of type SVGGElement.","BaseLayer.cast",{code:1});let t=y.layer,n=x.getAttrFrom(e,t.is);if(null!==n){if(n===t.is.value){let n=x.getAttrFrom(e,t.name);if(null!==n&&""!==n.trim())return!0;let i=`element must include '${t.name.xmlns.prefix}:${t.name.name}' attribute, and cannot be ''. `;throw new E(i,"BaseLayer.cast",{code:4})}{let e=`The value of element '${t.is.xmlns.prefix}.${t.is.name}' attribute must be '${t.is.value}',`;throw new E(e,"BaseLayer.cast",{code:3})}}{let e=`element must include '${t.is.xmlns.prefix}:${t.is.name}' attribute!`;throw new E(e,"BaseLayer.cast",{code:2})}}catch(t){let n=" element: "+e.cloneNode(!1).outerHTML;throw t.msg=t.msg+n,t}}static is(e){try{if(T._is(e))return!0}catch(e){return!1}}static _is(e){if(T._valid(e)){if(void 0!==e[h]&&e[h]instanceof T)return!0;throw new E("The element is not associated with an instance of Layer. ","Layer._is")}}static cast(e){if(T._is(e))return e[h]}setGraph(e){this._graph=e}setLayers(e){this._layers=e}get graph(){return this._graph}get layers(){return this._layers}get name(){return this._name}get visible(){return this._visible}set visible(e){e!=this._visible&&(this._visible=e,e?this._nativeNode.setAttribute("display",""):this._nativeNode.setAttribute("display","none"))}static located(e){let t=e;for(;;){let e=t.parentElement;if(null==e)break;if(T.is(e))return T.cast(e);if(e instanceof SVGSVGElement&&void 0!==e[r])break;t=e}return null}}class N{_graph;_nativeNode;_layerMap;_layerList;constructor(e){let t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new w(`0 or 1 argument required, but ${t} present.`,"Layers.constructor");N._valid(e)&&this._constructor_el(e)}this._layerList=new b,this._layerMap=new Map,this._nativeNode[h]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}_createNativeNode(){let e=document.createElementNS(o,"g");x.setAttrTo(e,y.layers.is,y.layers.is.value),this._nativeNode=e}static _valid(e){try{if(!(e instanceof SVGGElement))throw new w("'element' must be of type SVGGElement.","Layers._valid",{code:1});let t=y.layers,n=x.getAttrFrom(e,t.is);if(null!==n){if(n===t.is.value)return!0;{let e=`The value of element '${t.is.xmlns.prefix}.${t.is.name}' attribute must be '${t.is.value}',`;throw new E(e,"Layers._valid",{code:3})}}{let e=`element must include '${t.is.xmlns.prefix}:${t.is.name}' attribute!`;throw new E(e,"Layers._valid",{code:2})}}catch(t){let n=" element: "+e.cloneNode(!1).outerHTML;throw t.msg=t.msg+n,t}}static is(e){try{if(N._is(e))return!0}catch(e){return!1}}static _is(e){if(N._valid(e)){if(void 0!==e[h]&&e[h]instanceof N)return!0;throw new E("The element is not associated with an instance of Layers. ","Layers._is")}}static cast(e){if(N._is(e))return e[h]}get length(){return this._layerList.size}get graph(){return this._graph}get viewer(){return this._graph.viewer}get nativeNode(){return this._nativeNode}setGraph(e){this._graph=e}keys(){return this._layerList.keys()}values(){return this._layerList.values()}entries(){return this._layerList.entries()}forEach(e,t){this._layerList.forEach(e,t)}get(e){if("string"==typeof e)return this._layerMap.get(e);throw new w("The 'name' must be an string!","Layers.get")}at(e){if("number"==typeof e&&Number.isInteger(e)&&e>=0)return this._layerList.get(e);throw new w("The 'index' must be an integer greater than or equal to zero !","Layers.at")}add(e,t){if(!(e instanceof T))throw new w("The argument 'layer' must be an instance of Layer!","Layers.add");if(void 0!==this.get(e.name))throw new w(`A Layer named '${e.name}' already ExistedÔºÅ`,"Layers.add");if(void 0!==t&&!Number.isInteger(t))throw new w("The value of argument index must be an integer!","Layers.add");let n=this._nativeNode,i=this._layerList.size,o="index";if(0==i||void 0===t||t>i-1?o="end":t<0&&(t=0),"end"==o)this._layerList.add(e),n.appendChild(e.nativeNode);else{this._layerList.get(t).nativeNode.insertAdjacentElement("beforebegin",e.nativeNode),this._layerList.add(e,t)}this._layerMap.set(e.name,e),e.setGraph(this._graph),e.setLayers(this)}addTo(e,t,n){if(!(e instanceof T))throw new w("The argument 'layer' must be an instance of Layer!");if(!(t instanceof T))throw new w("The argument 'target' must be an instance of Layer!");if(void 0!==this.get(e.name))throw new w(`The ${e.name} layer already exists!`);let i,o=this._layerList.indexOf(t);if(-1==o)throw new w(`There is no '${t.name}' layer in the Graph!`);if(void 0!==n)if(i=n.toLowerCase(),"after"==i)o+=1,t.nativeNode.insertAdjacentElement("afterend",e.nativeNode),this._layerList.add(e,o);else{if("before"!=i)throw new w("where  must be either 'before' or 'after'");t.nativeNode.insertAdjacentElement("beforebegin",e.nativeNode),this._layerList.add(e,o)}else o+=1,t.nativeNode.insertAdjacentElement("afterend",e.nativeNode),this._layerList.add(e,o);this._layerMap.set(e.name,e),e.setGraph(this._graph),e.setLayers(this)}remove(e){if(!(e instanceof T))throw new w("The argument 'layer' must be an instance of Layer!");this._layerMap.delete(e.name),this._nativeNode.removeChild(e.nativeNode),this._layerList.remove(e)}move(e,t){if(!(e instanceof T))throw new w("The argument 'layer' must be an instance of Layer!");let n=this._layerList.size;if(0==n)return;let i=this._layerList.indexOf(e);if(-1==i)throw new w(`There is no '${e.name}' layer in the Graph!`);if(void 0===t)throw new w("Index must be included in the parameter!");if(!Number.isInteger(t))throw new w("index must be an integer!");if(i==t)return;if(i==t-1)return;if(0==i&&t<=i)return;let o=n-1;if(!(i==o&&t>=i))if(t<0&&(t=0),t>o){this._layerList.remove(e),this._layerList.add(e),this._nativeNode.appendChild(e.nativeNode)}else{this._layerList.get(t).nativeNode.insertAdjacentElement("beforebegin",e.nativeNode),this._layerList.remove(e),i<t&&(t-=1),this._layerList.add(e,t)}}moveUp(){}moveDown(){}moveTo(e,t,n){if(!(e instanceof T))throw new w("The argument 'layer' must be an instance of Layer!");if(!(t instanceof T))throw new w("The argument 'target' must be an instance of Layer!");if(0==this._layerList.size)return;let i=this._layerList.indexOf(t);if(-1==i)throw new w(`There is no '${t.name}' layer in the Graph!`);let o,s=this._layerList.indexOf(e);if(-1==s)throw new w(`There is no '${e.name}' layer in the Graph!`);if(i!=s){if(void 0!==n){let e=n.toLowerCase();if("after"==e){if(s==i+1)return;o="afterend"}else{if("before"!=e)throw new w("where  must be either 'before' or 'after'");if(s==i-1)return;o="beforebegin"}}else{if(s==i+1)return;o="afterend"}t.nativeNode.insertAdjacentElement(o,e.nativeNode),s<i&&i--,"afterend"==o&&i++,this._layerList.remove(e),this._layerList.add(e,i)}}moveToTop(){}moveToBottom(){}indexOf(e){return this._layerList.indexOf(e)}querySelector(e){let t=null;for(const n of this._layerList.values())if(t=n.querySelector(e),null!==t)break;return t}querySelectorAll(e){let t=new Array;for(const n of this._layerList.values()){let i=n.querySelectorAll(e);i.length>0&&(t=t.concat(i))}return t}getElementsByTagName(e){let t=new Array;for(const n of this._layerList.values()){let i=n.getElementsByTagName(e);i.length>0&&(t=t.concat(i))}return t}getElementsByClassName(e){let t=new Array;for(const n of this._layerList.values()){let i=n.getElementsByClassName(e);i.length>0&&(t=t.concat(i))}return t}}class Z extends T{constructor(e){if("string"==typeof e)super(e);else{if(!(e instanceof SVGGElement))throw new w("argument must be of type string or SVGGElement .","Layer.constructor");super(e)}}}class M{_clazz;constructor(e){this._clazz=e}static getLogger(e){return new M(e)}error(e,t){console.error(this._fullMsg("ERROR",e,t))}warn(e,t){console.warn(this._fullMsg("WARN",e,t))}info(e,t){console.log(this._fullMsg("INFO",e,t))}debug(e,t){console.debug(this._fullMsg("DEBUG",e,t))}_fullMsg(e,t,n){return void 0===n?`[${e}][${i}.${this._clazz}]: ${t}`:`[${e}][${i}.${this._clazz}.${n}]: ${t}`}}let C=function(){var e,t,n,i="",o=[],s={passive:!0};function r(t,r,a,l){var h;h="wheel"===n?a:function(e,t){var i=function(e){!e&&(e=window.event);var i={originalEvent:e,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==n?(i.deltaY=-1/40*e.wheelDelta,e.wheelDeltaX&&(i.deltaX=-1/40*e.wheelDeltaX)):i.deltaY=e.detail,t(i)};return o.push({element:e,fn:i}),i}(t,a),t[e](i+r,h,!!l&&s)}function a(e,r,a,l){var h;h="wheel"===n?a:function(e){for(var t=0;t<o.length;t++)if(o[t].element===e)return o[t].fn;return function(){}}(e),e[t](i+r,h,!!l&&s),function(e){for(var t=0;t<o.length;t++)if(o[t].element===e)return o.splice(t,1)}(e)}return window.addEventListener?(e="addEventListener",t="removeEventListener"):(e="attachEvent",t="detachEvent",i="on"),n="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",{on:function(e,t,i){r(e,n,t,i),"DOMMouseScroll"==n&&r(e,"MozMousePixelScroll",t,i)},off:function(e,t,i){a(e,n,t,i),"DOMMouseScroll"==n&&a(e,"MozMousePixelScroll",t,i)}}}(),L={extend:function(e,t){for(var n in e=e||{},t)this.isObject(t[n])?e[n]=this.extend(e[n],t[n]):e[n]=t[n];return e},isElement:function(e){return e instanceof HTMLElement||e instanceof SVGElement||e instanceof SVGSVGElement||e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getSvg:function(e){var t,n;if(this.isElement(e))t=e;else{if(!("string"==typeof e||e instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(!(t=document.querySelector(e)))throw new Error("Provided selector did not find any elements. Selector: "+e)}if("svg"===t.tagName.toLowerCase())n=t;else if("object"===t.tagName.toLowerCase())n=t.contentDocument.documentElement;else{if("embed"!==t.tagName.toLowerCase())throw"img"===t.tagName.toLowerCase()?new Error('Cannot script an SVG in an "img" element. Please use an "object" element or an in-line SVG.'):new Error("Cannot get SVG.");n=t.getSVGDocument().documentElement}return n},proxy:function(e,t){return function(){return e.apply(t,arguments)}},getType:function(e){return Object.prototype.toString.apply(e).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(e,t){if(void 0===e.clientX||null===e.clientX)if(e.clientX=0,e.clientY=0,void 0!==e.touches&&e.touches.length){if(void 0!==e.touches[0].clientX)e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY;else if(void 0!==e.touches[0].pageX){var n=t.getBoundingClientRect();e.clientX=e.touches[0].pageX-n.left,e.clientY=e.touches[0].pageY-n.top}}else void 0!==e.originalEvent&&void 0!==e.originalEvent.clientX&&(e.clientX=e.originalEvent.clientX,e.clientY=e.originalEvent.clientY)},isDblClick:function(e,t){if(2===e.detail)return!0;if(null!=t){var n=e.timeStamp-t.timeStamp,i=Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2));return n<250&&i<10}return!1},now:Date.now||function(){return(new Date).getTime()},throttle:function(e,t,n){var i,o,s,r=this,a=null,l=0;n||(n={});var h=function(){l=!1===n.leading?0:r.now(),a=null,s=e.apply(i,o),a||(i=o=null)};return function(){var u=r.now();l||!1!==n.leading||(l=u);var c=t-(u-l);return i=this,o=arguments,c<=0||c>t?(clearTimeout(a),a=null,l=u,s=e.apply(i,o),a||(i=o=null)):a||!1===n.trailing||(a=setTimeout(h,c)),s}},createRequestAnimationFrame:function(e){var t=null;return"auto"!==e&&e<60&&e>1&&(t=Math.floor(1e3/e)),null===t?window.requestAnimationFrame||A(33):A(t)}};function A(e){return function(t){window.setTimeout(t,e)}}var z="unknown";document.documentMode&&(z="ie");let G={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(e){if(e.clientWidth&&e.clientHeight)return{width:e.clientWidth,height:e.clientHeight};if(e.getBoundingClientRect())return e.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(e,t){var n=null;if(!(n=L.isElement(t)?t:e.querySelector(t))){var i=Array.prototype.slice.call(e.childNodes||e.children).filter((function(e){return"defs"!==e.nodeName&&"#text"!==e.nodeName}));1===i.length&&"g"===i[0].nodeName&&null===i[0].getAttribute("transform")&&(n=i[0])}if(!n){var o="viewport-"+(new Date).toISOString().replace(/\D/g,"");(n=document.createElementNS(this.svgNS,"g")).setAttribute("id",o);var s=e.childNodes||e.children;if(s&&s.length>0)for(var r=s.length;r>0;r--)"defs"!==s[s.length-r].nodeName&&n.appendChild(s[s.length-r]);e.appendChild(n)}var a=[];return n.getAttribute("class")&&(a=n.getAttribute("class").split(" ")),~a.indexOf("svg-pan-zoom_viewport")||(a.push("svg-pan-zoom_viewport"),n.setAttribute("class",a.join(" "))),n},setupSvgAttributes:function(e){if(e.setAttribute("xmlns",this.svgNS),e.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),e.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==e.parentNode){var t=e.getAttribute("style")||"";-1===t.toLowerCase().indexOf("overflow")&&e.setAttribute("style","overflow: hidden; "+t)}},internetExplorerRedisplayInterval:300,refreshDefsGlobal:L.throttle((function(){for(var e=document.querySelectorAll("defs"),t=e.length,n=0;n<t;n++){var i=e[n];i.parentNode.insertBefore(i,i)}}),null),setCTM:function(e,t,n){var i=this,o="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";e.setAttributeNS(null,"transform",o),"transform"in e.style?e.style.transform=o:"-ms-transform"in e.style?e.style["-ms-transform"]=o:"-webkit-transform"in e.style&&(e.style["-webkit-transform"]=o),"ie"===z&&n&&(n.parentNode.insertBefore(n,n),window.setTimeout((function(){i.refreshDefsGlobal()}),i.internetExplorerRedisplayInterval))},getEventPoint:function(e,t){var n=t.createSVGPoint();return L.mouseAndTouchNormalize(e,t),n.x=e.clientX,n.y=e.clientY,n},getSvgCenterPoint:function(e,t,n){return this.createSVGPoint(e,t/2,n/2)},createSVGPoint:function(e,t,n){var i=e.createSVGPoint();return i.x=t,i.y=n,i}};var V=function(e,t){this.init(e,t)};V.prototype.init=function(e,t){this.viewport=e,this.options=t,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=L.proxy(this.updateCTM,this),this.requestAnimationFrame=L.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();var n=this.processCTM();this.setCTM(n),this.updateCTM()},V.prototype.cacheViewBox=function(){var e=this.options.svg.getAttribute("viewBox");if(e){var t=e.split(/[\s\,]/).filter((function(e){return e})).map(parseFloat);this.viewBox.x=t[0],this.viewBox.y=t[1],this.viewBox.width=t[2],this.viewBox.height=t[3];var n=Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height);this.activeState.zoom=n,this.activeState.x=(this.options.width-this.viewBox.width*n)/2,this.activeState.y=(this.options.height-this.viewBox.height*n)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")}else this.simpleViewBoxCache()},V.prototype.simpleViewBoxCache=function(){var e=this.viewport.getBBox();this.viewBox.x=e.x,this.viewBox.y=e.y,this.viewBox.width=e.width,this.viewBox.height=e.height},V.prototype.getViewBox=function(){var e=this.viewport.getBBox();return this.viewBox.x=e.x,this.viewBox.y=e.y,this.viewBox.width=e.width,this.viewBox.height=e.height,L.extend({},this.viewBox)},V.prototype.processCTM=function(){var e,t=this.getCTM();(this.options.fit||this.options.contain)&&(e=this.options.fit?Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):Math.max(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),t.a=e,t.d=e,t.e=-this.viewBox.x*e,t.f=-this.viewBox.y*e);if(this.options.center){var n=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*t.a),i=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*t.a);t.e=n,t.f=i}return this.originalState.zoom=t.a,this.originalState.x=t.e,this.originalState.y=t.f,t},V.prototype.getOriginalState=function(){return L.extend({},this.originalState)},V.prototype.getState=function(){return L.extend({},this.activeState)},V.prototype.getZoom=function(){return this.activeState.zoom},V.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},V.prototype.computeRelativeZoom=function(e){return e/this.originalState.zoom},V.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},V.prototype.getCTM=function(){var e=this.options.svg.createSVGMatrix();return e.a=this.activeState.zoom,e.b=0,e.c=0,e.d=this.activeState.zoom,e.e=this.activeState.x,e.f=this.activeState.y,e},V.prototype.setCTM=function(e){var t=this.isZoomDifferent(e),n=this.isPanDifferent(e);if(t||n){if(t&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(e.a))?(e.a=e.d=this.activeState.zoom,t=!1):(this.updateCache(e),this.options.onZoom(this.getRelativeZoom()))),n){var i=this.options.beforePan(this.getPan(),{x:e.e,y:e.f}),o=!1,s=!1;!1===i?(e.e=this.getPan().x,e.f=this.getPan().y,o=s=!0):L.isObject(i)&&(!1===i.x?(e.e=this.getPan().x,o=!0):L.isNumber(i.x)&&(e.e=i.x),!1===i.y?(e.f=this.getPan().y,s=!0):L.isNumber(i.y)&&(e.f=i.y)),o&&s||!this.isPanDifferent(e)?n=!1:(this.updateCache(e),this.options.onPan(this.getPan()))}(t||n)&&this.updateCTMOnNextFrame()}},V.prototype.isZoomDifferent=function(e){return this.activeState.zoom!==e.a},V.prototype.isPanDifferent=function(e){return this.activeState.x!==e.e||this.activeState.y!==e.f},V.prototype.updateCache=function(e){this.activeState.zoom=e.a,this.activeState.x=e.e,this.activeState.y=e.f},V.prototype.pendingUpdate=!1,V.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},V.prototype.updateCTM=function(){var e=this.getCTM();G.setCTM(this.viewport,e,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(e)};var P=function(e,t){this.init(e,t)},B={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null},D={passive:!0};P.prototype.init=function(e,t){var n=this;this.svg=e,this.defs=e.querySelector("defs"),G.setupSvgAttributes(this.svg),this.options=L.extend(L.extend({},B),t),this.state="none";var i=G.getBoundingClientRectNormalized(e);this.width=i.width,this.height=i.height,this.viewport=function(e,t){return new V(e,t)}(G.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(e,t){if(n.viewport&&n.options.beforeZoom)return n.options.beforeZoom(e,t)},onZoom:function(e){if(n.viewport&&n.options.onZoom)return n.options.onZoom(e)},beforePan:function(e,t){if(n.viewport&&n.options.beforePan)return n.options.beforePan(e,t)},onPan:function(e){if(n.viewport&&n.options.onPan)return n.options.onPan(e)},onUpdatedCTM:function(e){if(n.viewport&&n.options.onUpdatedCTM)return n.options.onUpdatedCTM(e)}});var o=this.getPublicInstance();o.setBeforeZoom(this.options.beforeZoom),o.setOnZoom(this.options.onZoom),o.setBeforePan(this.options.beforePan),o.setOnPan(this.options.onPan),o.setOnUpdatedCTM(this.options.onUpdatedCTM),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},P.prototype.setupHandlers=function(){var e=this,t=null;if(this.eventListeners={mousedown:function(n){var i=e.handleMouseDown(n,t);return t=n,i},touchstart:function(n){var i=e.handleMouseDown(n,t);return t=n,i},mouseup:function(t){return e.handleMouseUp(t)},touchend:function(t){return e.handleMouseUp(t)},mousemove:function(t){return e.handleMouseMove(t)},touchmove:function(t){return e.handleMouseMove(t)},mouseleave:function(t){return e.handleMouseUp(t)},touchleave:function(t){return e.handleMouseUp(t)},touchcancel:function(t){return e.handleMouseUp(t)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var n=this.options.customEventsHandler.haltEventListeners;if(n&&n.length)for(var i=n.length-1;i>=0;i--)this.eventListeners.hasOwnProperty(n[i])&&delete this.eventListeners[n[i]]}for(var o in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(o,this.eventListeners[o],!this.options.preventMouseEventsDefault&&D);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},P.prototype.enableMouseWheelZoom=function(){if(!this.options.mouseWheelZoomEnabled){var e=this;this.wheelListener=function(t){return e.handleMouseWheel(t)};var t=!this.options.preventMouseEventsDefault;C.on(this.options.eventsListenerElement||this.svg,this.wheelListener,t),this.options.mouseWheelZoomEnabled=!0}},P.prototype.disableMouseWheelZoom=function(){if(this.options.mouseWheelZoomEnabled){var e=!this.options.preventMouseEventsDefault;C.off(this.options.eventsListenerElement||this.svg,this.wheelListener,e),this.options.mouseWheelZoomEnabled=!1}},P.prototype.handleMouseWheel=function(e){if(this.options.zoomEnabled&&"none"===this.state){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1);var t=e.deltaY||1,n=Date.now()-this.lastMouseWheelEventTime,i=3+Math.max(0,30-n);this.lastMouseWheelEventTime=Date.now(),"deltaMode"in e&&0===e.deltaMode&&e.wheelDelta&&(t=0===e.deltaY?0:Math.abs(e.wheelDelta)/e.deltaY),t=-.3<t&&t<.3?t:(t>0?1:-1)*Math.log(Math.abs(t)+10)/i;var o=this.svg.getScreenCTM().inverse(),s=G.getEventPoint(e,this.svg).matrixTransform(o),r=Math.pow(1+this.options.zoomScaleSensitivity,-1*t);this.zoomAtPoint(r,s)}},P.prototype.zoomAtPoint=function(e,t,n){var i=this.viewport.getOriginalState();n?(e=Math.max(this.options.minZoom*i.zoom,Math.min(this.options.maxZoom*i.zoom,e)),e/=this.getZoom()):this.getZoom()*e<this.options.minZoom*i.zoom?e=this.options.minZoom*i.zoom/this.getZoom():this.getZoom()*e>this.options.maxZoom*i.zoom&&(e=this.options.maxZoom*i.zoom/this.getZoom());var o=this.viewport.getCTM(),s=t.matrixTransform(o.inverse()),r=this.svg.createSVGMatrix().translate(s.x,s.y).scale(e).translate(-s.x,-s.y),a=o.multiply(r);a.a!==o.a&&this.viewport.setCTM(a)},P.prototype.zoom=function(e,t){this.zoomAtPoint(e,G.getSvgCenterPoint(this.svg,this.width,this.height),t)},P.prototype.publicZoom=function(e,t){t&&(e=this.computeFromRelativeZoom(e)),this.zoom(e,t)},P.prototype.publicZoomAtPoint=function(e,t,n){if(n&&(e=this.computeFromRelativeZoom(e)),"SVGPoint"!==L.getType(t)){if(!("x"in t)||!("y"in t))throw new Error("Given point is invalid");t=G.createSVGPoint(this.svg,t.x,t.y)}this.zoomAtPoint(e,t,n)},P.prototype.getZoom=function(){return this.viewport.getZoom()},P.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},P.prototype.computeFromRelativeZoom=function(e){return e*this.viewport.getOriginalState().zoom},P.prototype.resetZoom=function(){var e=this.viewport.getOriginalState();this.zoom(e.zoom,!0)},P.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},P.prototype.reset=function(){this.resetZoom(),this.resetPan()},P.prototype.handleDblClick=function(e){var t;this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),t=e.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity);var n=G.getEventPoint(e,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(t,n)},P.prototype.handleMouseDown=function(e,t){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),L.mouseAndTouchNormalize(e,this.svg),this.options.dblClickZoomEnabled&&L.isDblClick(e,t)?this.handleDblClick(e):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=G.getEventPoint(e,this.svg).matrixTransform(this.firstEventCTM.inverse()))},P.prototype.handleMouseMove=function(e){if(this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"pan"===this.state&&this.options.panEnabled){var t=G.getEventPoint(e,this.svg).matrixTransform(this.firstEventCTM.inverse()),n=this.firstEventCTM.translate(t.x-this.stateOrigin.x,t.y-this.stateOrigin.y);this.viewport.setCTM(n)}},P.prototype.handleMouseUp=function(e){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"pan"===this.state&&(this.state="none")},P.prototype.fit=function(){var e=this.viewport.getViewBox(),t=Math.min(this.width/e.width,this.height/e.height);this.zoom(t,!0)},P.prototype.contain=function(){var e=this.viewport.getViewBox(),t=Math.max(this.width/e.width,this.height/e.height);this.zoom(t,!0)},P.prototype.center=function(){var e=this.viewport.getViewBox(),t=.5*(this.width-(e.width+2*e.x)*this.getZoom()),n=.5*(this.height-(e.height+2*e.y)*this.getZoom());this.getPublicInstance().pan({x:t,y:n})},P.prototype.centerAt=function(e){this.viewport.getViewBox();var t=this.width/2-e.x*this.getZoom(),n=this.height/2-e.y*this.getZoom();this.getPublicInstance().pan({x:t,y:n})},P.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},P.prototype.pan=function(e){var t=this.viewport.getCTM();t.e=e.x,t.f=e.y,this.viewport.setCTM(t)},P.prototype.panX=function(e){var t=this.viewport.getCTM();t.e=e,this.viewport.setCTM(t)},P.prototype.panY=function(e){var t=this.viewport.getCTM();t.f=e,this.viewport.setCTM(t)},P.prototype.panBy=function(e){var t=this.viewport.getCTM();t.e+=e.x,t.f+=e.y,this.viewport.setCTM(t)},P.prototype.getPan=function(){var e=this.viewport.getState();return{x:e.x,y:e.y}},P.prototype.resize=function(){var e=G.getBoundingClientRectNormalized(this.svg);this.width=e.width,this.height=e.height;var t=this.viewport;t.options.width=this.width,t.options.height=this.height},P.prototype.destroy=function(){var e=this;for(var t in this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,this.onUpdatedCTM=null,null!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()}),this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(t,this.eventListeners[t],!this.options.preventMouseEventsDefault&&D);this.disableMouseWheelZoom(),this.reset(),O=O.filter((function(t){return t.svg!==e.svg})),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},P.prototype.getEventPoint=function(e,t){var n=G.getEventPoint(e,t).matrixTransform(t.getScreenCTM().inverse());return{x:n.x,y:n.y}},P.prototype.getPublicInstance=function(){var e=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return e.options.panEnabled=!0,e.pi},disablePan:function(){return e.options.panEnabled=!1,e.pi},isPanEnabled:function(){return!!e.options.panEnabled},pan:function(t){return e.pan(t),e.pi},panX:function(t){return e.panX(t),e.pi},panY:function(t){return e.panY(t),e.pi},panBy:function(t){return e.panBy(t),e.pi},getPan:function(){return e.getPan()},setBeforePan:function(t){return e.options.beforePan=null===t?null:L.proxy(t,e.publicInstance),e.pi},setOnPan:function(t){return e.options.onPan=null===t?null:L.proxy(t,e.publicInstance),e.pi},enableZoom:function(){return e.options.zoomEnabled=!0,e.pi},disableZoom:function(){return e.options.zoomEnabled=!1,e.pi},isZoomEnabled:function(){return!!e.options.zoomEnabled},enableDblClickZoom:function(){return e.options.dblClickZoomEnabled=!0,e.pi},disableDblClickZoom:function(){return e.options.dblClickZoomEnabled=!1,e.pi},isDblClickZoomEnabled:function(){return!!e.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return e.enableMouseWheelZoom(),e.pi},disableMouseWheelZoom:function(){return e.disableMouseWheelZoom(),e.pi},isMouseWheelZoomEnabled:function(){return!!e.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(t){return e.options.zoomScaleSensitivity=t,e.pi},getZoomScaleSensitivity:function(){return e.options.zoomScaleSensitivity},setMinZoom:function(t){return e.options.minZoom=t,e.pi},getMinZoom:function(){return e.options.minZoom},setMaxZoom:function(t){return e.options.maxZoom=t,e.pi},getMaxZoom:function(){return e.options.maxZoom},setBeforeZoom:function(t){return e.options.beforeZoom=null===t?null:L.proxy(t,e.publicInstance),e.pi},setOnZoom:function(t){return e.options.onZoom=null===t?null:L.proxy(t,e.publicInstance),e.pi},zoom:function(t){return e.publicZoom(t,!0),e.pi},zoomBy:function(t){return e.publicZoom(t,!1),e.pi},zoomAtPoint:function(t,n){return e.publicZoomAtPoint(t,n,!0),e.pi},zoomAtPointBy:function(t,n){return e.publicZoomAtPoint(t,n,!1),e.pi},zoomIn:function(){return this.zoomBy(1+e.options.zoomScaleSensitivity),e.pi},zoomOut:function(){return this.zoomBy(1/(1+e.options.zoomScaleSensitivity)),e.pi},getZoom:function(){return e.getRelativeZoom()},setOnUpdatedCTM:function(t){return e.options.onUpdatedCTM=null===t?null:L.proxy(t,e.publicInstance),e.pi},resetZoom:function(){return e.resetZoom(),e.pi},resetPan:function(){return e.resetPan(),e.pi},reset:function(){return e.reset(),e.pi},fit:function(){return e.fit(),e.pi},contain:function(){return e.contain(),e.pi},center:function(){return e.center(),e.pi},centerAt:function(t){return e.centerAt(t),e.pi},updateBBox:function(){return e.updateBBox(),e.pi},resize:function(){return e.resize(),e.pi},getSizes:function(){return{width:e.width,height:e.height,realZoom:e.getZoom(),viewBox:e.viewport.getViewBox()}},destroy:function(){return e.destroy(),e.pi},getEventPoint:function(t,n){return e.getEventPoint(t,n)}}),this.publicInstance};var O=[];class ${static sync(e,t){let n=new XMLHttpRequest;if(n.open(e,t,!1),n.send(null),n.onerror=()=>{let e=`GET '${t}' failed,xhr.status=${n.status},xhr.statusText=${n.statusText}.`;throw new w(e,"Ajax.sync")},200==n.status)return n.responseText;{let e=`GET '${t}' failed,xhr.status=${n.status},xhr.statusText=${n.statusText}.`;throw new w(e,"Ajax.sync")}}static async(e,t,n){let i=new XMLHttpRequest;i.open(e,t,!0),i.send(null),i.onerror=()=>{let e=`GET '${t}' failed,xhr.status=${i.status},xhr.statusText=${i.statusText}.`;throw new w(e,"Ajax.async")},i.onload=function(){n(i.responseText)}}}class R{load(e,t){let n=this;$.async("get",e,(function(i){let o;try{o=n._parseFromString(i)}catch{throw n._parserSVGXml(i,e),new E("Unknown exception. ","SVGLoader.load")}t(o)}))}_parseFromString(e){let t=document.createElement("template");t.innerHTML=e;let n=t.content.firstElementChild;if(n instanceof SVGSVGElement)return n;throw new Error}_parserSVGXml(e,t){let n=e,i=(new DOMParser).parseFromString(n,"image/svg+xml").documentElement;if(!(i instanceof SVGSVGElement)){let e;const n=i.querySelector("parsererror");throw e=n?n.children[1].textContent.trim():"unknown error",e=`The file obtained from '${t}' failed to parse correctly as an SVG documentÔºåand the file contains the following errors: ${e}.`,new E(e,"SVGLoader._parserSVGXml")}return i}}class I extends R{constructor(){super()}loadSync(e){let t=$.sync("get",e);try{return this._parseFromString(t)}catch{this._parserSVGXml(t,e)}}}class k extends S{constructor(e){super();let t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new w(`0 or 1 argument required, but ${t} present.`,"Layers.constructor");k._valid(e)&&this._constructor_el(e)}this._nativeNode[h]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new k:new k(e)}_createNativeNode(){let e=document.createElementNS(o,"defs");x.setAttrTo(e,y.defs.is,y.defs.is.value),this._nativeNode=e}static _valid(e){try{if(!(e instanceof SVGDefsElement))throw new w("'element' must be of type SVGDefsElement.","Defs._valid",{code:1});let t=y.defs,n=x.getAttrFrom(e,t.is);if(null!==n){if(n===t.is.value)return!0;{let e=`The value of element '${t.is.xmlns.prefix}.${t.is.name}' attribute must be '${t.is.value}',`;throw new E(e,"Defs._valid",{code:3})}}{let e=`element must include '${t.is.xmlns.prefix}:${t.is.name}' attribute!`;throw new E(e,"Defs._valid",{code:2})}}catch(t){let n=" element: "+e.cloneNode(!1).outerHTML;throw t.msg=t.msg+n,t}}static is(e){try{if(this._is(e))return!0}catch(e){return!1}}static _is(e){if(k._valid(e)){if(void 0!==e[h]&&e[h]instanceof k)return!0;throw new E("The element is not associated with an instance of Defs. ","Defs._is")}}static cast(e){if(k._is(e))return e[h]}}class H extends S{constructor(e){super();let t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new w(`0 or 1 argument required, but ${t} present.`,"Style.constructor");H._valid(e)&&this._constructor_el(e)}this._nativeNode[h]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new H:new H(e)}_createNativeNode(){let e=document.createElementNS(o,"style");x.setAttrTo(e,y.style.is,y.style.is.value),this._nativeNode=e}static _valid(e){try{if(!(e instanceof SVGStyleElement))throw new w("'node' must be of type SVGStyleElement.","Style._valid",{code:1});let t=y.style,n=x.getAttrFrom(e,t.is);if(null!==n){if(n===t.is.value)return!0;{let e=`The value of element '${t.is.xmlns.prefix}.${t.is.name}' attribute must be '${t.is.value}',`;throw new E(e,"Style._valid",{code:3})}}{let e=`element must include '${t.is.xmlns.prefix}:${t.is.name}' attribute!`;throw new E(e,"Style._valid",{code:2})}}catch(t){let n;throw n=e instanceof Element?" element: "+e.cloneNode(!1).outerHTML:" node: "+e.textContent,t.msg=t.msg+n,t}}static is(e){try{if(H._is(e))return!0}catch(e){return!1}}static _is(e){if(H._valid(e)){if(void 0!==e[h]&&e[h]instanceof H)return!0;throw new E("The element is not associated with an instance of Style. ","Style._is")}}static cast(e){if(H._is(e))return e[h]}get sheet(){return this.nativeNode.sheet}get disabled(){return this.nativeNode.disabled}set disabled(e){this.nativeNode.disabled=e}get media(){return this.nativeNode.media}set media(e){this.nativeNode.media=e}}class U extends S{constructor(e){super();let t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new w(`0 or 1 argument required, but ${t} present.`,"Metadata.constructor");U._valid(e)&&this._constructor_el(e)}this._nativeNode[h]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new U:new U(e)}_createNativeNode(){let e=document.createElementNS(o,"metadata");x.setAttrTo(e,y.metadata.is,y.metadata.is.value),this._nativeNode=e}static _valid(e){try{if(!(e instanceof SVGMetadataElement))throw new w("'element' must be of type SVGMetadataElement.","Metadata._valid",{code:1});let t=y.metadata,n=x.getAttrFrom(e,t.is);if(null!==n){if(n===t.is.value)return!0;{let e=`The value of element '${t.is.xmlns.prefix}.${t.is.name}' attribute must be '${t.is.value}',`;throw new E(e,"Metadata._valid",{code:3})}}{let e=`element must include '${t.is.xmlns.prefix}:${t.is.name}' attribute!`;throw new E(e,"Metadata._valid",{code:2})}}catch(t){let n=" element: "+e.cloneNode(!1).outerHTML;throw t.msg=t.msg+n,t}}static is(e){try{if(U._is(e))return!0}catch(e){return!1}}static _is(e){if(U._valid(e)){if(void 0!==e[h]&&e[h]instanceof U)return!0;throw new E("The element is not associated with an instance of Metadata. ","Metadata._is")}}static cast(e){if(U._is(e))return e[h]}}class q{_logger=M.getLogger("BaseGraph");_viewer=null;_panZoomer;_modeledSVG=null;_svg;_topNodes=new b;_metadata=null;_style=null;_defs=null;_layers=null;_viewport;constructor(e){if(this._svg=this._createSVG(),this._panZoom(this._svg),this._viewport=this._svg.querySelector(".svg-pan-zoom_viewport"),this._svg[r]=this,void 0!==e&&this._importSVG(e),null==this._layers){let e=new N;e.setGraph(this),this.getViewport().appendChild(e.nativeNode),this._layers=e,this._topNodes.add(e)}}_createSVG(){let t=document.createElementNS(o,"svg"),n="_hyGraph_"+e.get();t.setAttribute("id",n),t.setAttributeNS(s,"xmlns:xlink","http://www.w3.org/1999/xlink"),t.style.display="block",t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.style.boxSizing="border-box",t.oncontextmenu=function(e){return!1},t.style.userSelect="none";for(let e of _){if(null===e.prefix)throw new w("The xmlns.prefix of proporty 'xmlnsSet' of parameter 'configs' cannot be 'null'.","Viewer._createSVG");if(null===e.namespaceURI)throw new w("The xmlns.namespaceURI of proporty 'xmlnsSet' of parameter 'configs' cannot be 'null'.","Viewer._createSVG");t.setAttributeNS(s,"xmlns:"+e.prefix,e.namespaceURI)}return t}_panZoom(e){this._panZoomer=function(e,t){var n=L.getSvg(e);if(null===n)return null;for(var i=O.length-1;i>=0;i--)if(O[i].svg===n)return O[i].instance.getPublicInstance();return O.push({svg:n,instance:new P(n,t)}),O[O.length-1].instance.getPublicInstance()}(e,{viewportSelector:".svg-pan-zoom_viewport",zoomEnabled:!0,fit:!1,center:!1,contain:!1,minZoom:.05,maxZoom:50,preventMouseEventsDefault:!1})}_importSVG(e){if(!(e instanceof SVGSVGElement||"string"==typeof e))throw new w("'svg' must be of type 'string' or 'SVGSVGElement'.","Viewer.create");if("string"==typeof e){e=(new I).loadSync(e)}this._fillGraph(e),this._modeledSVG=e.cloneNode(!1)}_fillGraph(e){this._copySVGAttrToGraph(e),this._moveElementsToGraph(e)}_copySVGAttrToGraph(e){let t=this._svg;const i=n.removeAttrs(e.style.cssText,["width","height","x","y","position","top","left","bottom","right"]);t.style.cssText=i+";"+t.style.cssText}_moveElementsToGraph(e){this.getViewport();let t=e.children,n=t.length;for(let e=0;e<n;e++){let e=t[0];if(e instanceof SVGMetadataElement)this._moveMetadataToGraph(e);else if(e instanceof SVGStyleElement)this._moveStyleToGraph(e);else if(e instanceof SVGDefsElement)this._moveDefsToGraph(e);else if(e instanceof SVGGElement)this._moveLayersToGraph(e);else{if(!(e instanceof SVGDescElement)){let t="All top-level elements in the SVG can only be <desc>,<metadata>,<style>,<defs> or <g>.";throw t+=" illegal element: "+e.cloneNode(!1).outerHTML,new E(t,"BaseGraph._moveElementsToGraph")}this._moveDescToGraph(e)}}}_replaceSVGScriptElement(e){let t=e.getAttribute("src")||e.getAttribute("href"),n=document.createElement("script");return n.type=e.getAttribute("type")||"text/javascript",null==t?n.text=e.innerHTML:n.src=t,e.remove(),n}_moveDescToGraph(e){this.getViewport().insertAdjacentElement("beforebegin",e)}_moveMetadataToGraph(e){if(null!=this._metadata){let t="All top-level elements in the SVG, can only there one <metadata> element .";throw t+=" illegal element: "+e.cloneNode(!1).outerHTML+".",new E(t,"BaseGraph._moveMetadataToGraph")}{let t=U._create(e);t.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._metadata=t,this._topNodes.add(t)}}_moveStyleToGraph(e){if(null!=this._style){let t="All top-level elements in the SVG, can only there one <style> element .";throw t+=" illegal element: "+e.cloneNode(!1).outerHTML+".",new E(t,"BaseGraph._moveStyleToGraph")}{let t=H._create(e);t.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._style=t,this._topNodes.add(t)}}_moveDefsToGraph(e){if(null!=this._defs){let t="All top-level elements in the SVG, can only there one <defs> element .";throw t+=" illegal element: "+e.cloneNode(!1).outerHTML+".",new E(t,"BaseGraph._moveDefsToGraph")}{let t=k._create(e);t.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._defs=t,this._topNodes.add(t)}}_moveLayersToGraph(e){if(null!=this._layers){let t='All top-level elements in the SVG, can only there one <g is="Layers"> element .';throw t+=" illegal element: "+e.cloneNode(!1).outerHTML+".",new E(t,"BaseGraph._moveLayersToGraph")}{let t=e.cloneNode(!1),n=new N(t);n.setGraph(this);let i=e.children,o=i.length,s=0;for(let e=0;e<o;e++){let e=i[s],t=new Z(e);n.add(t)}e.remove(),this.getViewport().appendChild(n.nativeNode),this._layers=n,this._topNodes.add(n)}}_getPanZoomer(){return this._panZoomer}_getSVG(){return this._svg}getModeledSVG(){return this._modeledSVG}getViewport(){return this._viewport}get viewer(){return this._viewer}get layers(){return this._layers}get metadata(){if(null==this._metadata){let e=U._create();e.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._metadata=e,this._topNodes.add(e)}return this._metadata}get style(){if(null==this._style){let e=H._create();e.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._style=e,this._topNodes.add(e)}return this._style}get defs(){if(null==this._defs){let e=k._create();e.setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._defs=e,this._topNodes.add(e)}return this._defs}}class W extends q{constructor(e){super(e)}getElementById(e){if(void 0===e)return;let t=`#${CSS.escape(e)}`,n=null;for(const e of this._topNodes.values())if(n=e.querySelector(t),null!==n)return n;return n}querySelector(e){let t=null;for(const n of this._topNodes.values())if(t=n.querySelector(e),null!==t)return t;return t}querySelectorAll(e){let t=new Array;for(const n of this._topNodes.values()){let i=n.querySelectorAll(e);i.length>0&&(t=t.concat(i))}return t}getElementsByTagName(e){let t=new Array;for(const n of this._topNodes.values()){let i=n.getElementsByTagName(e);i.length>0&&(t=t.concat(i))}return t}getElementsByClassName(e){let t=new Array;for(const n of this._topNodes.values()){let i=n.getElementsByClassName(e);i.length>0&&(t=t.concat(i))}return t}}class j{_width;_height;constructor(e,t){this._width=e,this._height=t}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}}class X{_x;_y;constructor(e,t){this._x=e,this._y=t}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}}class F{_x;_y;_width;_height;constructor(e,t,n,i){this._x=e,this._y=t,this._width=n,this._height=i}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}const Y={Viewer:class{_logger=new M("Viewer");_container;_innnerContainer;_shadowRoot;_svg;_graph=null;_panZoomer;_eventListener={};_listenerAnonym="_anonym";_EventType={RESIZE:"resize",PANSTART:"panstart",PANEND:"panend",ZOOMSTART:"zoomstart",ZOOMEND:"zoomend",CLICK:"click",CONTEXTMENU:"contextmenu",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup"};_resizeEvent={};_resizeObserver;_resizeIsfirst=!0;_resizeInitWidth;_resizefInitHeight;constructor(e,t){let n=arguments.length;if(2!=n)throw new w(`2 argument required, but  ${n} present.`,"Viewer.constructor");if("string"==typeof e){if(this._container=document.getElementById(e),null===this._container)throw new w(`Element with id='${e}'  not found,`,"Viewer.constructor")}else{if(!(e instanceof HTMLDivElement))throw new w("'svg' must be of type 'string' or 'HTMLDivElement'.","Viewer.constructor");this._container=e}if(!(t instanceof W))throw new w("'graph' must be of type  'Graph'.","Viewer.constructor");this._graph=t,t._viewer=this,this._constructor()}_constructor(){let e=this._createInnerContainer();this._container.appendChild(e),this._shadowRoot=e.attachShadow({mode:"closed"}),this._svg=this.graph._getSVG(),this._shadowRoot.appendChild(this._svg),this._panZoomer=this.graph._getPanZoomer(),this._panZoomer.resize(),this._listenSvgResize(this._svg)}_createInnerContainer(){let t=document.createElement("div");return t.id=e.get(),t.style.width="100%",t.style.height="100%",this._innnerContainer=t,t}_listenSvgResize(e){this._resizeInitWidth=this._innnerContainer.clientWidth,this._resizefInitHeight=this._innnerContainer.clientHeight,this._resizeEvent.oldWidth=this.width,this._resizeEvent.oldHeight=this.height;let t=new ResizeObserver((e=>{e.forEach((e=>{this._onSvgResize(e)}))}));t.observe(this._innnerContainer),this._resizeObserver=t}_onSvgResize(e){if(this._resizeIsfirst){this._resizeIsfirst=!1;let t=e.target.clientWidth,n=e.target.clientHeight;this._resizeInitWidth==t&&this._resizefInitHeight==n||this._ResizeCallback(e)}else this._ResizeCallback(e)}_ResizeCallback(e){if(this._panZoomer.resize(),this._EventType.RESIZE in this._eventListener){let e={type:this._EventType.RESIZE,target:this,currentTarget:this,event:null,oldSize:new j(this._resizeEvent.oldWidth,this._resizeEvent.oldHeight),newSize:new j(this.width,this.height)};this._resizeEvent.oldWidth=this.width,this._resizeEvent.oldHeight=this.height;let t=this._eventListener[this._EventType.RESIZE];for(let n of t)n(e)}}_css(e,t){return 0===arguments.length?n.style(this._svg):1===arguments.length?n.style(this._svg,e):2===arguments.length?n.style(this._svg,e,t):void 0}get container(){return this._container}get graph(){return this._graph}get width(){return this._panZoomer.getSizes().width}get height(){return this._panZoomer.getSizes().height}set border(e){this._css("border",e)}get border(){return this._css("border")}set background(e){this._css("background",e)}get background(){return this._css("background")}set stopContextmenu(e){let t=this._svg;t.oncontextmenu=e?function(e){return!1}:null}get stopContextmenu(){return null!=this._svg.oncontextmenu}set draggable(e){e?this._panZoomer.enablePan():this._panZoomer.disablePan()}get draggable(){return this._panZoomer.isPanEnabled()}set dblClickZoomEnabled(e){e?this._panZoomer.enableDblClickZoom():this._panZoomer.disableDblClickZoom()}get dblClickZoomEnabled(){return this._panZoomer.isDblClickZoomEnabled()}set mouseWheelZoomEnabled(e){e?this._panZoomer.enableMouseWheelZoom():this._panZoomer.disableMouseWheelZoom()}get mouseWheelZoomEnabled(){return this._panZoomer.isMouseWheelZoomEnabled()}set zoomSensitivity(e){this._panZoomer.setZoomScaleSensitivity(e)}get zoomSensitivity(){return this._panZoomer.getZoomScaleSensitivity()}set minZoom(e){this._panZoomer.setMinZoom(e)}get minZoom(){return this._panZoomer.getMinZoom()}set maxZoom(e){this._panZoomer.setMaxZoom(e)}get maxZoom(){return this._panZoomer.getMaxZoom()}pan(e,t){if(1==arguments.length)this._panZoomer.pan({x:e,y:e});else{if(2!=arguments.length)throw new w(`1 or 2 argument required, but ${arguments.length} present.`,"Viewer.pan");this._panZoomer.pan({x:e,y:t})}}panX(e){this._panZoomer.panX(e)}panY(e){this._panZoomer.panY(e)}panOn(e,t){if(1==arguments.length)this._panZoomer.panBy({x:e,y:e});else{if(2!=arguments.length)throw new w(`1 or 2 argument required, but ${arguments.length} present.`,"Viewer.panOn");this._panZoomer.panBy({x:e,y:t})}}panXOn(e){this._panZoomer.panBy({x:e,y:0})}panYOn(e){this._panZoomer.panBy({x:0,y:e})}center(e){if(void 0===e)this._panZoomer.center();else{let t=this._svg.createSVGPoint();t.x=e.x,t.y=e.y,this._panZoomer.centerAt(t)}}getCurrentPan(){return this._panZoomer.getPan()}resetPan(){this._panZoomer.resetPan()}zoom(e,t){if(1==arguments.length)this._panZoomer.zoom(e);else{if(2!=arguments.length)throw new w(`1 or 2 argument required, but  ${arguments.length} present.`,"Viewer.zoom");{let n=this._svg.createSVGPoint();n.x=t.x,n.y=t.y,this._panZoomer.zoomAtPoint(e,n)}}}zoomIn(){this._panZoomer.zoomIn()}zoomOut(){this._panZoomer.zoomOut()}zoomOn(e,t){if(1===arguments.length)this._panZoomer.zoomBy(e);else{if(2!==arguments.length)throw new w(`1 or 2 argument required, but  ${arguments.length} present.`,"Viewer.zoomOn");{let n=this._svg.createSVGPoint();n.x=t.x,n.y=t.y,this._panZoomer.zoomAtPointBy(e,n)}}}getCurrentZoom(){return this._panZoomer.getZoom()}resetZoom(){this._panZoomer.resetZoom()}fit(){this._panZoomer.fit()}contain(){this._panZoomer.contain()}zoomFull(){this._panZoomer.fit(),this._panZoomer.center()}zoomBox(e,t){let n=this.width/t.width,i=this.height/t.height,o=n>i?i:n,s=new X(e.x+t.width/2,e.y+t.height/2);this.zoomOn(o,s);let r=this.width/2-s.x,a=this.height/2-s.y;this.panOn(r,a)}toVCS(e){let t=this.getCurrentPan(),n=this.getCurrentZoom(),i=e.x*n+t.x,o=e.y*n+t.y;return new X(i,o)}toUCS(e){let t=this.getCurrentPan(),n=this.getCurrentZoom(),i=(e.x-t.x)/n,o=(e.y-t.y)/n;return new X(i,o)}reset(){this._panZoomer.resetZoom(),this._panZoomer.resetPan()}getBBox(){let e=this._panZoomer.getSizes().viewBox;return new F(e.x,e.y,e.width,e.height)}saveAs(e){this._svg}addEventListener(e,t){let n=e.toLowerCase();switch(n){case this._EventType.RESIZE:if(n in this._eventListener){let e=this._eventListener[n];e.has(t)?this._logger.warn("The callback for this event type is already registered."):e.add(t)}else{let e=new Set;e.add(t),this._eventListener[n]=e}break;case this._EventType.PANSTART:case this._EventType.PANEND:case this._EventType.ZOOMSTART:case this._EventType.ZOOMEND:let i={type:n,target:this,currentTarget:this,event:null};if(n==this._EventType.PANSTART){let e=(e,n)=>(i.oldPan=e,i.newPan=n,t(i));this._panZoomer.setBeforePan(e)}if(n==this._EventType.PANEND){let e=e=>{i.pan=e,t(i)};this._panZoomer.setOnPan(e)}if(n==this._EventType.ZOOMSTART){let e=(e,n)=>(i.oldZoom=e,i.newZoom=n,t(i));this._panZoomer.setBeforeZoom(e)}if(n==this._EventType.ZOOMEND){let e=e=>{i.zoom=e,t(i)};this._panZoomer.setOnZoom(e)}break;default:let o=n+this._listenerAnonym,s=e=>{this._eventHandler(e,t)};if(n in this._eventListener){let e=this._eventListener[n];if(e.has(t)){this._logger.warn("The callback for this event type is already registered");break}e.add(t),this._eventListener[o].set(t,s)}else{let e=new Set;e.add(t),this._eventListener[n]=e;let i=new Map;i.set(t,s),this._eventListener[o]=i}this._svg.addEventListener(e,s)}}_eventHandler(e,t){let n=e.target instanceof SVGSVGElement?this:e.target,i={type:e.type,target:n,currentTarget:this,event:e};switch(e.type){case this._EventType.CLICK:case this._EventType.CONTEXTMENU:case this._EventType.DBLCLICK:case this._EventType.MOUSEDOWN:case this._EventType.MOUSEMOVE:case this._EventType.MOUSEUP:let t=this._panZoomer.getEventPoint(e,this._svg);i.point=t}t(i)}removeEventListener(e,t){let n=e.toLowerCase();switch(n){case this._EventType.RESIZE:if(n in this._eventListener){let e=this._eventListener[n];e.has(t)&&(e.delete(t),0==e.size&&delete this._eventListener[n])}break;case this._EventType.PANSTART:case this._EventType.PANEND:case this._EventType.ZOOMSTART:case this._EventType.ZOOMEND:n==this._EventType.PANSTART&&this._panZoomer.setBeforePan(null),n==this._EventType.PANEND&&this._panZoomer.setOnPan(null),n==this._EventType.ZOOMSTART&&this._panZoomer.setBeforeZoom(null),n==this._EventType.ZOOMEND&&this._panZoomer.setOnZoom(null);break;default:if(n in this._eventListener){let i=n+this._listenerAnonym,o=this._eventListener[n];if(o.has(t)){o.delete(t);let s=this._eventListener[i],r=s.get(t);this._svg.removeEventListener(e,r),s.delete(t),0==o.size&&(delete this._eventListener[n],delete this._eventListener[i])}}}}destroy(){this._resizeObserver.unobserve(this._innnerContainer),this._panZoomer.destroy(),this.container.removeChild(this._innnerContainer);for(var e=Object.keys(this),t=0;t<e.length;t++)delete this[e[t]]}},Graph:W,Layers:N,Layer:Z,Style:H,Defs:k,Metadata:U,SVGLoader:R,Point:X,Size:j,Box:F,Vector:class{_x;_y;constructor(e,t){this._x=e,this._y=t}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}},Error:w,SVGParserError:E};export{Y as default};

