/*
   * Huayou JavaScript library  v0.6.5
   * http://github.com/HuayouJS/Huayou
   * HuayouJS<huayou-service@hotmail.com>
   * Original work Copyright (C) by Andrea Leofreddi (SVGPan) and bumbu(svg-pan-zoom)
   * Modified work Copyright (C) 2023 - present by HuayouJS (Huayou)
   * @license
   */
class UUID{static get(){return(new Date).toISOString().replace(/\D/g,"")}}class Str{static camelCase(e){return e.toLowerCase().replace(/-(.)/g,function(e,t){return t.toUpperCase()})}static unCamelCase(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}static isBlank(e){return/^(\s+)?$/.test(e)}}class CSS$1{static style(e,t,n){const i={};if(1===arguments.length)return e.style.cssText.split(/\s*;\s*/).filter(function(e){return!!e.length}).forEach(function(e){e=e.split(/\s*:\s*/);i[e[0]]=e[1]}),i;if(2===arguments.length){if(Array.isArray(t)){for(const r of t){var o=Str.camelCase(r);i[r]=e.style[o]}return i}if("string"==typeof t)return e.style[Str.camelCase(t)];if("object"==typeof t)for(const s in t)e.style[Str.camelCase(s)]=null==t[s]||Str.isBlank(t[s])?"":t[s]}3===arguments.length&&(e.style[Str.camelCase(t)]=null==n||Str.isBlank(n)?"":n)}static removeAttrs(e,n){let i="";return e.split(/\s*;\s*/).filter(function(e){return!!e.length}).forEach(function(e){var t=e.split(/\s*:\s*/);n.includes(t[0])||(i=i+";"+e)}),i}}class Xmlns{constructor(e,t){this.prefix=e,this.namespaceURI=t}}const App={name:"huayou",version:"@@version",outputName:"Huayou"},Constants={SvgNS:"http://www.w3.org/2000/svg",XmlnsNS:"http://www.w3.org/2000/xmlns/",CACHE_GRAPH:"huayouCacheGraph",HuayouNSPrefix:"huayou",HuayouNS:"com.huayoujs.xsvg",ElementProxy:"_hyElemProxy"},huayouXmlns=new Xmlns(Constants.HuayouNSPrefix,Constants.HuayouNS);class AttrDict{constructor(e,t){this.name=e,this.xmlns=t}}class AttrValueDict extends AttrDict{constructor(e,t,n){super(e,n),this.value=t}}class BasicSchema{constructor(){this.metadata=new MetadataSchemaImpl,this.style=new StyleSchemaImpl,this.defs=new DefsSchemaImpl,this.layers=new LayersSchemaImpl,this.layer=new LayerSchemaImpl}}class MetadataSchemaImpl{constructor(){this.is=new AttrValueDict("is","Metadata",huayouXmlns)}}class StyleSchemaImpl{constructor(){this.is=new AttrValueDict("is","Style",huayouXmlns)}}class DefsSchemaImpl{constructor(){this.is=new AttrValueDict("is","Defs",huayouXmlns)}}class LayersSchemaImpl{constructor(){this.is=new AttrValueDict("is","Layers",huayouXmlns)}}class LayerSchemaImpl{constructor(){this.is=new AttrValueDict("is","Layer",huayouXmlns),this.name=new AttrDict("name",huayouXmlns)}}let xmlnsSet=new Set([huayouXmlns]),xmlSchema=new BasicSchema;class HuayouError extends Error{constructor(e,t=null,n=null){super(),this._msg=e,this._at=t,this.cause=n,this.name=App.outputName+".Error",this.message=this._fullMsg()}_fullMsg(){let e;return e=null!==this._at?`Failed to execute '${App.outputName}.${this._at}': `+this._msg:this._msg}}class ArrayList{constructor(){this._array=new Array}get size(){return this._array.length}add(e,t){1==arguments.length?this._array.push(e):2==arguments.length&&this._array.splice(t,0,e)}get(e){return this._array.at(e)}has(e){return this._array.includes(e)}indexOf(e){return this._array.indexOf(e)}remove(e){e=this.indexOf(e);this._array.splice(e,1)}removeAt(e){this._array.splice(e,1)}keys(){return this._array.keys()}values(){return this._array.values()}entries(){return this._array.entries()}forEach(e,t){this._array.forEach(e,t)}}class AttrDictHelper{static getAttrFrom(e,t){let n;return n=null!==t.xmlns?e.getAttribute(t.xmlns.prefix+":"+t.name):e.getAttribute(t.name)}static setAttrTo(e,t,n){null!==t.xmlns?e.setAttribute(t.xmlns.prefix+":"+t.name,n):e.setAttribute(t.name,n)}static hasAttr(e,t){let n;return n=null!==t.xmlns?e.hasAttribute(t.xmlns.prefix+":"+t.name):e.hasAttribute(t.name)}static removeAttr(e,t){null!==t.xmlns?e.removeAttribute(t.xmlns.prefix+":"+t.name):e.removeAttribute(t.name)}}class SVGParserError extends HuayouError{constructor(e,t=null,n=null){super(e,t,n),this.name=App.outputName+".SVGParserError"}}class Container{get viewer(){return this._graph.viewer}get graph(){return this._graph}get nativeNode(){return this._nativeNode}setGraph(e){this._graph=e}get children(){return Array.from(this.nativeNode.children)}get firstElementChild(){return this.nativeNode.firstElementChild}get lastElementChild(){return this.nativeNode.lastElementChild}get childNodes(){return Array.from(this.nativeNode.childNodes)}get firstChild(){return this.nativeNode.firstChild}get lastChild(){return this.nativeNode.lastChild}get textContent(){return this.nativeNode.textContent}appendChild(e){return this.nativeNode.appendChild(e)}removeChild(e){return this.nativeNode.removeChild(e)}insertBefore(e,t){return this.nativeNode.insertBefore(e,t)}append(...e){this.nativeNode.append(...e)}prepend(...e){this.nativeNode.prepend(...e)}contains(e){return e!==this.nativeNode&&this.nativeNode.contains(e)}hasChildNodes(){return this.nativeNode.hasChildNodes()}replaceChild(e,t){return this.nativeNode.replaceChild(e,t)}querySelector(e){try{return this.nativeNode.querySelector(e)}catch(e){throw new HuayouError(e.message,"Graph.querySelector")}}querySelectorAll(e){try{var t=this.nativeNode.querySelectorAll(e);return Array.from(t)}catch(e){throw new HuayouError(e.message,"Graph.querySelectorAll")}}getElementsByTagName(e){e=this.nativeNode.getElementsByTagName(e);return Array.from(e)}getElementsByClassName(e){e=this.nativeNode.getElementsByClassName(e);return Array.from(e)}}class BaseLayer extends Container{constructor(e){super(),this._visible=!0;var t=arguments.length;if(1!=t)throw new HuayouError(`1 argument required, but ${t} present.`,"BaseLayer.constructor");if("string"==typeof e){if(""==e.trim())throw new HuayouError("'name'  cannot be an empty string.","BaseLayer.constructor");this._constructor(e)}else{if(!(e instanceof SVGGElement))throw new HuayouError("argument must be of type string or SVGGElement .","BaseLayer.constructor");BaseLayer._valid(e)&&this._constructor_el(e)}this._nativeNode[Constants.ElementProxy]=this}_constructor(e){this._name=e,this._createNativeNode(e)}_constructor_el(e){var t=xmlSchema.layer,t=AttrDictHelper.getAttrFrom(e,t.name),t=(this._name=t,this._nativeNode=e,this._nativeNode.getAttribute("display"));this._visible="none"!=t}_createNativeNode(e){var t=document.createElementNS(Constants.SvgNS,"g");AttrDictHelper.setAttrTo(t,xmlSchema.layer.is,xmlSchema.layer.is.value),AttrDictHelper.setAttrTo(t,xmlSchema.layer.name,e),this._nativeNode=t,this._visible=!0}static _valid(t){try{if(!(t instanceof SVGGElement))throw new HuayouError("'element' must be of type SVGGElement.","BaseLayer.cast",{code:1});var e,n=xmlSchema.layer,i=AttrDictHelper.getAttrFrom(t,n.is);if(null===i)throw s=`element must include '${n.is.xmlns.prefix}:${n.is.name}' `+"attribute!",new SVGParserError(s,"BaseLayer.cast",{code:2});if(i!==n.is.value)throw e=`The value of element '${n.is.xmlns.prefix}.${n.is.name}' `+`attribute must be '${n.is.value}',`,new SVGParserError(e,"BaseLayer.cast",{code:3});var o=AttrDictHelper.getAttrFrom(t,n.name);if(null!==o&&""!==o.trim())return!0;var r=`element must include '${n.name.xmlns.prefix}:${n.name.name}' `+"attribute, and cannot be ''. ";throw new SVGParserError(r,"BaseLayer.cast",{code:4})}catch(e){var s=" element: "+t.cloneNode(!1).outerHTML;throw e.msg=e.msg+s,e}}static is(e){try{if(BaseLayer._is(e))return!0}catch(e){return!1}}static _is(e){if(BaseLayer._valid(e)){if(void 0!==e[Constants.ElementProxy]&&e[Constants.ElementProxy]instanceof BaseLayer)return!0;throw new SVGParserError("The element is not associated with an instance of Layer. ","Layer._is")}}static cast(e){if(BaseLayer._is(e))return e[Constants.ElementProxy]}setGraph(e){this._graph=e}setLayers(e){this._layers=e}get graph(){return this._graph}get layers(){return this._layers}get name(){return this._name}get visible(){return this._visible}set visible(e){e!=this._visible&&((this._visible=e)?this._nativeNode.setAttribute("display",""):this._nativeNode.setAttribute("display","none"))}static located(e){let t=e;for(;;){var n=t.parentElement;if(null==n)break;if(BaseLayer.is(n))return BaseLayer.cast(n);if(n instanceof SVGSVGElement&&void 0!==n[Constants.CACHE_GRAPH])break;t=n}return null}}class Layers{constructor(e){var t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new HuayouError(`0 or 1 argument required, but ${t} present.`,"Layers.constructor");Layers._valid(e)&&this._constructor_el(e)}this._layerList=new ArrayList,this._layerMap=new Map,this._nativeNode[Constants.ElementProxy]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}_createNativeNode(){var e=document.createElementNS(Constants.SvgNS,"g");AttrDictHelper.setAttrTo(e,xmlSchema.layers.is,xmlSchema.layers.is.value),this._nativeNode=e}static _valid(t){try{if(!(t instanceof SVGGElement))throw new HuayouError("'element' must be of type SVGGElement.","Layers._valid",{code:1});var e,n=xmlSchema.layers,i=AttrDictHelper.getAttrFrom(t,n.is);if(null===i)throw o=`element must include '${n.is.xmlns.prefix}:${n.is.name}' `+"attribute!",new SVGParserError(o,"Layers._valid",{code:2});if(i===n.is.value)return!0;throw e=`The value of element '${n.is.xmlns.prefix}.${n.is.name}' `+`attribute must be '${n.is.value}',`,new SVGParserError(e,"Layers._valid",{code:3})}catch(e){var o=" element: "+t.cloneNode(!1).outerHTML;throw e.msg=e.msg+o,e}}static is(e){try{if(Layers._is(e))return!0}catch(e){return!1}}static _is(e){if(Layers._valid(e)){if(void 0!==e[Constants.ElementProxy]&&e[Constants.ElementProxy]instanceof Layers)return!0;throw new SVGParserError("The element is not associated with an instance of Layers. ","Layers._is")}}static cast(e){if(Layers._is(e))return e[Constants.ElementProxy]}get length(){return this._layerList.size}get graph(){return this._graph}get viewer(){return this._graph.viewer}get nativeNode(){return this._nativeNode}setGraph(e){this._graph=e}keys(){return this._layerList.keys()}values(){return this._layerList.values()}entries(){return this._layerList.entries()}forEach(e,t){this._layerList.forEach(e,t)}get(e){if("string"==typeof e)return this._layerMap.get(e);throw new HuayouError("The 'name' must be an string!","Layers.get")}at(e){if("number"==typeof e&&Number.isInteger(e)&&0<=e)return this._layerList.get(e);throw new HuayouError("The 'index' must be an integer greater than or equal to zero !","Layers.at")}add(e,t){if(!(e instanceof BaseLayer))throw new HuayouError("The argument layer must be an instance of Layer and cannot be null or undefined!","Layers.add");if(void 0!==this.get(e.name))throw new HuayouError(`A Layer named '${e.name}' already Existed！`,"Layers.add");if(void 0!==t&&!Number.isInteger(t))throw new HuayouError("The value of argument index must be an integer!","Layers.add");var n=this._nativeNode,i=this._layerList.size;let o="index";0==i||void 0===t||i-1<t?o="end":t<0&&(t=0),"end"==o?(this._layerList.add(e),n.appendChild(e.nativeNode)):(this._layerList.get(t).nativeNode.insertAdjacentElement("beforebegin",e.nativeNode),this._layerList.add(e,t)),this._layerMap.set(e.name,e),e.setGraph(this._graph),e.setLayers(this)}addTo(e,t,n){if(!(e instanceof BaseLayer))throw new HuayouError("The layer must be of type Layer and cannot be null or undefined!");if(!(t instanceof BaseLayer))throw new HuayouError("The target must be of type Layer and cannot be null or undefined!");if(void 0!==this.get(e.name))throw new HuayouError(`The ${e.name} layer already exists!`);let i=this._layerList.indexOf(t);if(-1==i)throw new HuayouError(`There is no '${t.name}' layer in the Graph!`);if(void 0!==n)if("after"==(n=n.toLowerCase()))i+=1,t.nativeNode.insertAdjacentElement("afterend",e.nativeNode);else{if("before"!=n)throw new HuayouError("where  must be either 'before' or 'after'");t.nativeNode.insertAdjacentElement("beforebegin",e.nativeNode)}else i+=1,t.nativeNode.insertAdjacentElement("afterend",e.nativeNode);this._layerList.add(e,i),this._layerMap.set(e.name,e),e.setGraph(this._graph),e.setLayers(this)}remove(e){this._layerMap.delete(e.name),this._nativeNode.removeChild(e.nativeNode),this._layerList.remove(e)}move(e,t){if(!(e instanceof BaseLayer))throw new HuayouError("The layer must be of type Layer and cannot be null or undefined!");var n=this._layerList.size;if(0!=n){var i=this._layerList.indexOf(e);if(-1==i)throw new HuayouError(`There is no '${e.name}' layer in the Graph!`);if(void 0===t)throw new HuayouError("Index must be included in the parameter!");if(!Number.isInteger(t))throw new HuayouError("index must be an integer!");i==t||i==t-1||0==i&&t<=i||i==(n=n-1)&&i<=t||(n<(t=t<0?0:t)?(this._layerList.remove(e),this._layerList.add(e),this._nativeNode.appendChild(e.nativeNode)):(this._layerList.get(t).nativeNode.insertAdjacentElement("beforebegin",e.nativeNode),this._layerList.remove(e),i<t&&(t-=1),this._layerList.add(e,t)))}}moveUp(){}moveDown(){}moveTo(n,i,o){if(!(n instanceof BaseLayer))throw new HuayouError("The layer must be of type Layer and cannot be null or undefined!");if(!(i instanceof BaseLayer))throw new HuayouError("The target must be of type Layer and cannot be null or undefined!");var r=this._layerList.size;if(0!=r){let t=this._layerList.indexOf(i);if(-1==t)throw new HuayouError(`There is no '${i.name}' layer in the Graph!`);r=this._layerList.indexOf(n);if(-1==r)throw new HuayouError(`There is no '${n.name}' layer in the Graph!`);if(t!=r){let e;if(void 0!==o){o=o.toLowerCase();if("after"==o){if(r==t+1)return;e="afterend"}else{if("before"!=o)throw new HuayouError("where  must be either 'before' or 'after'");if(r==t-1)return;e="beforebegin"}}else{if(r==t+1)return;e="afterend"}i.nativeNode.insertAdjacentElement(e,n.nativeNode),r<t&&t--,"afterend"==e&&t++,this._layerList.remove(n),this._layerList.add(n,t)}}}moveToTop(){}moveToBottom(){}indexOf(e){return this._layerList.indexOf(e)}querySelector(e){let t=null;for(const n of this._layerList.values())if(null!==(t=n.querySelector(e)))break;return t}querySelectorAll(e){let t=new Array;for(const i of this._layerList.values()){var n=i.querySelectorAll(e);0<n.length&&(t=t.concat(n))}return t}getElementsByTagName(e){let t=new Array;for(const i of this._layerList.values()){var n=i.getElementsByTagName(e);0<n.length&&(t=t.concat(n))}return t}getElementsByClassName(e){let t=new Array;for(const i of this._layerList.values()){var n=i.getElementsByClassName(e);0<n.length&&(t=t.concat(n))}return t}}class Layer extends BaseLayer{constructor(e){if("string"!=typeof e&&!(e instanceof SVGGElement))throw new HuayouError("argument must be of type string or SVGGElement .","Layer.constructor");super(e)}}class Logger{constructor(e){this._clazz=e}static getLogger(e){return new Logger(e)}error(e,t){console.error(this._fullMsg("ERROR",e,t))}warn(e,t){console.warn(this._fullMsg("WARN",e,t))}info(e,t){console.log(this._fullMsg("INFO",e,t))}debug(e,t){console.debug(this._fullMsg("DEBUG",e,t))}_fullMsg(e,t,n){return void 0===n?`[${e}][${App.outputName}.${this._clazz}]: `+t:`[${e}][${App.outputName}.${this._clazz}.${n}]: `+t}}let Uniwheel=function(){var o,s,a,l="",h=[],u={passive:!0};function r(e,n){function t(e){var t={originalEvent:e=e||window.event,target:e.target||e.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==e.type?0:1,deltaX:0,delatZ:0,preventDefault:function(){e.preventDefault?e.preventDefault():e.returnValue=!1}};return"mousewheel"==a?(t.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(t.deltaX=-.025*e.wheelDeltaX)):t.deltaY=e.detail,n(t)}return h.push({element:e,fn:t}),t}function i(e,t,n,i){n="wheel"===a?n:r(e,n);e[o](l+t,n,!!i&&u)}function c(e,t,n,i){for(var n="wheel"===a?n:function(e){for(var t=0;t<h.length;t++)if(h[t].element===e)return h[t].fn;return function(){}}(e),o=(e[s](l+t,n,!!i&&u),e),r=0;r<h.length;r++)if(h[r].element===o)return void h.splice(r,1)}return window.addEventListener?(o="addEventListener",s="removeEventListener"):(o="attachEvent",s="detachEvent",l="on"),a="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",{on:function(e,t,n){i(e,a,t,n),"DOMMouseScroll"==a&&i(e,"MozMousePixelScroll",t,n)},off:function(e,t,n){c(e,a,t,n),"DOMMouseScroll"==a&&c(e,"MozMousePixelScroll",t,n)}}}(),Utils={extend:function(e,t){for(var n in e=e||{},t)this.isObject(t[n])?e[n]=this.extend(e[n],t[n]):e[n]=t[n];return e},isElement:function(e){return e instanceof HTMLElement||e instanceof SVGElement||e instanceof SVGSVGElement||e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getSvg:function(e){var t,n;if(this.isElement(e))t=e;else{if(!("string"==typeof e||e instanceof String))throw new Error("Provided selector is not an HTML object nor String");if(!(t=document.querySelector(e)))throw new Error("Provided selector did not find any elements. Selector: "+e)}if("svg"===t.tagName.toLowerCase())n=t;else if("object"===t.tagName.toLowerCase())n=t.contentDocument.documentElement;else{if("embed"!==t.tagName.toLowerCase())throw"img"===t.tagName.toLowerCase()?new Error('Cannot script an SVG in an "img" element. Please use an "object" element or an in-line SVG.'):new Error("Cannot get SVG.");n=t.getSVGDocument().documentElement}return n},proxy:function(e,t){return function(){return e.apply(t,arguments)}},getType:function(e){return Object.prototype.toString.apply(e).replace(/^\[object\s/,"").replace(/\]$/,"")},mouseAndTouchNormalize:function(e,t){void 0!==e.clientX&&null!==e.clientX||(e.clientX=0,void(e.clientY=0)!==e.touches&&e.touches.length?void 0!==e.touches[0].clientX?(e.clientX=e.touches[0].clientX,e.clientY=e.touches[0].clientY):void 0!==e.touches[0].pageX&&(t=t.getBoundingClientRect(),e.clientX=e.touches[0].pageX-t.left,e.clientY=e.touches[0].pageY-t.top):void 0!==e.originalEvent&&void 0!==e.originalEvent.clientX&&(e.clientX=e.originalEvent.clientX,e.clientY=e.originalEvent.clientY))},isDblClick:function(e,t){var n;return 2===e.detail||null!=t&&(n=e.timeStamp-t.timeStamp,e=Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2)),n<250)&&e<10},now:Date.now||function(){return(new Date).getTime()},throttle:function(n,i,o){function r(){c=!1===o.leading?0:h.now(),u=null,l=n.apply(s,a),u||(s=a=null)}var s,a,l,h=this,u=null,c=0;o=o||{};return function(){var e=h.now(),t=(c||!1!==o.leading||(c=e),i-(e-c));return s=this,a=arguments,t<=0||i<t?(clearTimeout(u),u=null,c=e,l=n.apply(s,a),u||(s=a=null)):u||!1===o.trailing||(u=setTimeout(r,t)),l}},createRequestAnimationFrame:function(e){var t=null;return null===(t="auto"!==e&&e<60&&1<e?Math.floor(1e3/e):t)?window.requestAnimationFrame||requestTimeout(33):requestTimeout(t)}};function requestTimeout(t){return function(e){window.setTimeout(e,t)}}var _browser="unknown";document.documentMode&&(_browser="ie");let SvgUtils={svgNS:"http://www.w3.org/2000/svg",xmlNS:"http://www.w3.org/XML/1998/namespace",xmlnsNS:"http://www.w3.org/2000/xmlns/",xlinkNS:"http://www.w3.org/1999/xlink",evNS:"http://www.w3.org/2001/xml-events",getBoundingClientRectNormalized:function(e){if(e.clientWidth&&e.clientHeight)return{width:e.clientWidth,height:e.clientHeight};if(e.getBoundingClientRect())return e.getBoundingClientRect();throw new Error("Cannot get BoundingClientRect for SVG.")},getOrCreateViewport:function(e,t){var n=null;if((n=Utils.isElement(t)?t:e.querySelector(t))||1===(t=Array.prototype.slice.call(e.childNodes||e.children).filter(function(e){return"defs"!==e.nodeName&&"#text"!==e.nodeName})).length&&"g"===t[0].nodeName&&null===t[0].getAttribute("transform")&&(n=t[0]),!n){var t="viewport-"+(new Date).toISOString().replace(/\D/g,""),i=((n=document.createElementNS(this.svgNS,"g")).setAttribute("id",t),e.childNodes||e.children);if(i&&0<i.length)for(var o=i.length;0<o;o--)"defs"!==i[i.length-o].nodeName&&n.appendChild(i[i.length-o]);e.appendChild(n)}t=[];return~(t=n.getAttribute("class")?n.getAttribute("class").split(" "):t).indexOf("svg-pan-zoom_viewport")||(t.push("svg-pan-zoom_viewport"),n.setAttribute("class",t.join(" "))),n},setupSvgAttributes:function(e){var t;e.setAttribute("xmlns",this.svgNS),e.setAttributeNS(this.xmlnsNS,"xmlns:xlink",this.xlinkNS),e.setAttributeNS(this.xmlnsNS,"xmlns:ev",this.evNS),null!==e.parentNode&&-1===(t=e.getAttribute("style")||"").toLowerCase().indexOf("overflow")&&e.setAttribute("style","overflow: hidden; "+t)},internetExplorerRedisplayInterval:300,refreshDefsGlobal:Utils.throttle(function(){for(var e=document.querySelectorAll("defs"),t=e.length,n=0;n<t;n++){var i=e[n];i.parentNode.insertBefore(i,i)}},null),setCTM:function(e,t,n){var i=this,t="matrix("+t.a+","+t.b+","+t.c+","+t.d+","+t.e+","+t.f+")";e.setAttributeNS(null,"transform",t),"transform"in e.style?e.style.transform=t:"-ms-transform"in e.style?e.style["-ms-transform"]=t:"-webkit-transform"in e.style&&(e.style["-webkit-transform"]=t),"ie"===_browser&&n&&(n.parentNode.insertBefore(n,n),window.setTimeout(function(){i.refreshDefsGlobal()},i.internetExplorerRedisplayInterval))},getEventPoint:function(e,t){var n=t.createSVGPoint();return Utils.mouseAndTouchNormalize(e,t),n.x=e.clientX,n.y=e.clientY,n},getSvgCenterPoint:function(e,t,n){return this.createSVGPoint(e,t/2,n/2)},createSVGPoint:function(e,t,n){e=e.createSVGPoint();return e.x=t,e.y=n,e}};var ShadowViewport=function(e,t){this.init(e,t)};ShadowViewport.prototype.init=function(e,t){this.viewport=e,this.options=t,this.originalState={zoom:1,x:0,y:0},this.activeState={zoom:1,x:0,y:0},this.updateCTMCached=Utils.proxy(this.updateCTM,this),this.requestAnimationFrame=Utils.createRequestAnimationFrame(this.options.refreshRate),this.viewBox={x:0,y:0,width:0,height:0},this.cacheViewBox();e=this.processCTM();this.setCTM(e),this.updateCTM()},ShadowViewport.prototype.cacheViewBox=function(){var e=this.options.svg.getAttribute("viewBox");e?(e=e.split(/[\s\,]/).filter(function(e){return e}).map(parseFloat),this.viewBox.x=e[0],this.viewBox.y=e[1],this.viewBox.width=e[2],this.viewBox.height=e[3],e=Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),this.activeState.zoom=e,this.activeState.x=(this.options.width-this.viewBox.width*e)/2,this.activeState.y=(this.options.height-this.viewBox.height*e)/2,this.updateCTMOnNextFrame(),this.options.svg.removeAttribute("viewBox")):this.simpleViewBoxCache()},ShadowViewport.prototype.simpleViewBoxCache=function(){var e=this.viewport.getBBox();this.viewBox.x=e.x,this.viewBox.y=e.y,this.viewBox.width=e.width,this.viewBox.height=e.height},ShadowViewport.prototype.getViewBox=function(){var e=this.viewport.getBBox();return this.viewBox.x=e.x,this.viewBox.y=e.y,this.viewBox.width=e.width,this.viewBox.height=e.height,Utils.extend({},this.viewBox)},ShadowViewport.prototype.processCTM=function(){var e,t,n=this.getCTM();return(this.options.fit||this.options.contain)&&(e=this.options.fit?Math.min(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height):Math.max(this.options.width/this.viewBox.width,this.options.height/this.viewBox.height),n.a=e,n.d=e,n.e=-this.viewBox.x*e,n.f=-this.viewBox.y*e),this.options.center&&(e=.5*(this.options.width-(this.viewBox.width+2*this.viewBox.x)*n.a),t=.5*(this.options.height-(this.viewBox.height+2*this.viewBox.y)*n.a),n.e=e,n.f=t),this.originalState.zoom=n.a,this.originalState.x=n.e,this.originalState.y=n.f,n},ShadowViewport.prototype.getOriginalState=function(){return Utils.extend({},this.originalState)},ShadowViewport.prototype.getState=function(){return Utils.extend({},this.activeState)},ShadowViewport.prototype.getZoom=function(){return this.activeState.zoom},ShadowViewport.prototype.getRelativeZoom=function(){return this.activeState.zoom/this.originalState.zoom},ShadowViewport.prototype.computeRelativeZoom=function(e){return e/this.originalState.zoom},ShadowViewport.prototype.getPan=function(){return{x:this.activeState.x,y:this.activeState.y}},ShadowViewport.prototype.getCTM=function(){var e=this.options.svg.createSVGMatrix();return e.a=this.activeState.zoom,e.b=0,e.c=0,e.d=this.activeState.zoom,e.e=this.activeState.x,e.f=this.activeState.y,e},ShadowViewport.prototype.setCTM=function(e){var t,n,i,o=this.isZoomDifferent(e),r=this.isPanDifferent(e);(o||r)&&(o&&(!1===this.options.beforeZoom(this.getRelativeZoom(),this.computeRelativeZoom(e.a))?(e.a=e.d=this.activeState.zoom,o=!1):(this.updateCache(e),this.options.onZoom(this.getRelativeZoom()))),r&&((i=n=!1)===(t=this.options.beforePan(this.getPan(),{x:e.e,y:e.f}))?(e.e=this.getPan().x,e.f=this.getPan().y,n=i=!0):Utils.isObject(t)&&(!1===t.x?(e.e=this.getPan().x,n=!0):Utils.isNumber(t.x)&&(e.e=t.x),!1===t.y?(e.f=this.getPan().y,i=!0):Utils.isNumber(t.y)&&(e.f=t.y)),n&&i||!this.isPanDifferent(e)?r=!1:(this.updateCache(e),this.options.onPan(this.getPan()))),o||r)&&this.updateCTMOnNextFrame()},ShadowViewport.prototype.isZoomDifferent=function(e){return this.activeState.zoom!==e.a},ShadowViewport.prototype.isPanDifferent=function(e){return this.activeState.x!==e.e||this.activeState.y!==e.f},ShadowViewport.prototype.updateCache=function(e){this.activeState.zoom=e.a,this.activeState.x=e.e,this.activeState.y=e.f},ShadowViewport.prototype.pendingUpdate=!1,ShadowViewport.prototype.updateCTMOnNextFrame=function(){this.pendingUpdate||(this.pendingUpdate=!0,this.requestAnimationFrame.call(window,this.updateCTMCached))},ShadowViewport.prototype.updateCTM=function(){var e=this.getCTM();SvgUtils.setCTM(this.viewport,e,this.defs),this.pendingUpdate=!1,this.options.onUpdatedCTM&&this.options.onUpdatedCTM(e)};let createShadowViewport=function(e,t){return new ShadowViewport(e,t)};var SvgPanZoom=function(e,t){this.init(e,t)},optionsDefaults={viewportSelector:".svg-pan-zoom_viewport",panEnabled:!0,zoomEnabled:!0,dblClickZoomEnabled:!0,mouseWheelZoomEnabled:!0,preventMouseEventsDefault:!0,zoomScaleSensitivity:.1,minZoom:.5,maxZoom:10,fit:!0,contain:!1,center:!0,refreshRate:"auto",beforeZoom:null,onZoom:null,beforePan:null,onPan:null,customEventsHandler:null,eventsListenerElement:null,onUpdatedCTM:null},passiveListenerOption={passive:!0},instancesStore=(SvgPanZoom.prototype.init=function(e,t){var n=this,t=(this.svg=e,this.defs=e.querySelector("defs"),SvgUtils.setupSvgAttributes(this.svg),this.options=Utils.extend(Utils.extend({},optionsDefaults),t),this.state="none",SvgUtils.getBoundingClientRectNormalized(e)),e=(this.width=t.width,this.height=t.height,this.viewport=createShadowViewport(SvgUtils.getOrCreateViewport(this.svg,this.options.viewportSelector),{svg:this.svg,width:this.width,height:this.height,fit:this.options.fit,contain:this.options.contain,center:this.options.center,refreshRate:this.options.refreshRate,beforeZoom:function(e,t){if(n.viewport&&n.options.beforeZoom)return n.options.beforeZoom(e,t)},onZoom:function(e){if(n.viewport&&n.options.onZoom)return n.options.onZoom(e)},beforePan:function(e,t){if(n.viewport&&n.options.beforePan)return n.options.beforePan(e,t)},onPan:function(e){if(n.viewport&&n.options.onPan)return n.options.onPan(e)},onUpdatedCTM:function(e){if(n.viewport&&n.options.onUpdatedCTM)return n.options.onUpdatedCTM(e)}}),this.getPublicInstance());e.setBeforeZoom(this.options.beforeZoom),e.setOnZoom(this.options.onZoom),e.setBeforePan(this.options.beforePan),e.setOnPan(this.options.onPan),e.setOnUpdatedCTM(this.options.onUpdatedCTM),this.lastMouseWheelEventTime=Date.now(),this.setupHandlers()},SvgPanZoom.prototype.setupHandlers=function(){var e,n=this,i=null;if(this.eventListeners={mousedown:function(e){var t=n.handleMouseDown(e,i);return i=e,t},touchstart:function(e){var t=n.handleMouseDown(e,i);return i=e,t},mouseup:function(e){return n.handleMouseUp(e)},touchend:function(e){return n.handleMouseUp(e)},mousemove:function(e){return n.handleMouseMove(e)},touchmove:function(e){return n.handleMouseMove(e)},mouseleave:function(e){return n.handleMouseUp(e)},touchleave:function(e){return n.handleMouseUp(e)},touchcancel:function(e){return n.handleMouseUp(e)}},null!=this.options.customEventsHandler){this.options.customEventsHandler.init({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()});var t=this.options.customEventsHandler.haltEventListeners;if(t&&t.length)for(var o=t.length-1;0<=o;o--)this.eventListeners.hasOwnProperty(t[o])&&delete this.eventListeners[t[o]]}for(e in this.eventListeners)(this.options.eventsListenerElement||this.svg).addEventListener(e,this.eventListeners[e],!this.options.preventMouseEventsDefault&&passiveListenerOption);this.options.mouseWheelZoomEnabled&&(this.options.mouseWheelZoomEnabled=!1,this.enableMouseWheelZoom())},SvgPanZoom.prototype.enableMouseWheelZoom=function(){var t,e;this.options.mouseWheelZoomEnabled||((t=this).wheelListener=function(e){return t.handleMouseWheel(e)},e=!this.options.preventMouseEventsDefault,Uniwheel.on(this.options.eventsListenerElement||this.svg,this.wheelListener,e),this.options.mouseWheelZoomEnabled=!0)},SvgPanZoom.prototype.disableMouseWheelZoom=function(){var e;this.options.mouseWheelZoomEnabled&&(e=!this.options.preventMouseEventsDefault,Uniwheel.off(this.options.eventsListenerElement||this.svg,this.wheelListener,e),this.options.mouseWheelZoomEnabled=!1)},SvgPanZoom.prototype.handleMouseWheel=function(e){var t,n;this.options.zoomEnabled&&"none"===this.state&&(this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),t=e.deltaY||1,n=Date.now()-this.lastMouseWheelEventTime,n=3+Math.max(0,30-n),this.lastMouseWheelEventTime=Date.now(),t=-.3<(t="deltaMode"in e&&0===e.deltaMode&&e.wheelDelta?0===e.deltaY?0:Math.abs(e.wheelDelta)/e.deltaY:t)&&t<.3?t:(0<t?1:-1)*Math.log(Math.abs(t)+10)/n,n=this.svg.getScreenCTM().inverse(),e=SvgUtils.getEventPoint(e,this.svg).matrixTransform(n),n=Math.pow(1+this.options.zoomScaleSensitivity,-1*t),this.zoomAtPoint(n,e))},SvgPanZoom.prototype.zoomAtPoint=function(e,t,n){var i=this.viewport.getOriginalState(),n=(n?(e=Math.max(this.options.minZoom*i.zoom,Math.min(this.options.maxZoom*i.zoom,e)),e/=this.getZoom()):this.getZoom()*e<this.options.minZoom*i.zoom?e=this.options.minZoom*i.zoom/this.getZoom():this.getZoom()*e>this.options.maxZoom*i.zoom&&(e=this.options.maxZoom*i.zoom/this.getZoom()),this.viewport.getCTM()),i=t.matrixTransform(n.inverse()),t=this.svg.createSVGMatrix().translate(i.x,i.y).scale(e).translate(-i.x,-i.y),e=n.multiply(t);e.a!==n.a&&this.viewport.setCTM(e)},SvgPanZoom.prototype.zoom=function(e,t){this.zoomAtPoint(e,SvgUtils.getSvgCenterPoint(this.svg,this.width,this.height),t)},SvgPanZoom.prototype.publicZoom=function(e,t){t&&(e=this.computeFromRelativeZoom(e)),this.zoom(e,t)},SvgPanZoom.prototype.publicZoomAtPoint=function(e,t,n){if(n&&(e=this.computeFromRelativeZoom(e)),"SVGPoint"!==Utils.getType(t)){if(!("x"in t&&"y"in t))throw new Error("Given point is invalid");t=SvgUtils.createSVGPoint(this.svg,t.x,t.y)}this.zoomAtPoint(e,t,n)},SvgPanZoom.prototype.getZoom=function(){return this.viewport.getZoom()},SvgPanZoom.prototype.getRelativeZoom=function(){return this.viewport.getRelativeZoom()},SvgPanZoom.prototype.computeFromRelativeZoom=function(e){return e*this.viewport.getOriginalState().zoom},SvgPanZoom.prototype.resetZoom=function(){var e=this.viewport.getOriginalState();this.zoom(e.zoom,!0)},SvgPanZoom.prototype.resetPan=function(){this.pan(this.viewport.getOriginalState())},SvgPanZoom.prototype.reset=function(){this.resetZoom(),this.resetPan()},SvgPanZoom.prototype.handleDblClick=function(e){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),t=e.shiftKey?1/(2*(1+this.options.zoomScaleSensitivity)):2*(1+this.options.zoomScaleSensitivity);var t,e=SvgUtils.getEventPoint(e,this.svg).matrixTransform(this.svg.getScreenCTM().inverse());this.zoomAtPoint(t,e)},SvgPanZoom.prototype.handleMouseDown=function(e,t){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),Utils.mouseAndTouchNormalize(e,this.svg),this.options.dblClickZoomEnabled&&Utils.isDblClick(e,t)?this.handleDblClick(e):(this.state="pan",this.firstEventCTM=this.viewport.getCTM(),this.stateOrigin=SvgUtils.getEventPoint(e,this.svg).matrixTransform(this.firstEventCTM.inverse()))},SvgPanZoom.prototype.handleMouseMove=function(e){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"pan"===this.state&&this.options.panEnabled&&(e=SvgUtils.getEventPoint(e,this.svg).matrixTransform(this.firstEventCTM.inverse()),e=this.firstEventCTM.translate(e.x-this.stateOrigin.x,e.y-this.stateOrigin.y),this.viewport.setCTM(e))},SvgPanZoom.prototype.handleMouseUp=function(e){this.options.preventMouseEventsDefault&&(e.preventDefault?e.preventDefault():e.returnValue=!1),"pan"===this.state&&(this.state="none")},SvgPanZoom.prototype.fit=function(){var e=this.viewport.getViewBox(),e=Math.min(this.width/e.width,this.height/e.height);this.zoom(e,!0)},SvgPanZoom.prototype.contain=function(){var e=this.viewport.getViewBox(),e=Math.max(this.width/e.width,this.height/e.height);this.zoom(e,!0)},SvgPanZoom.prototype.center=function(){var e=this.viewport.getViewBox(),t=.5*(this.width-(e.width+2*e.x)*this.getZoom()),e=.5*(this.height-(e.height+2*e.y)*this.getZoom());this.getPublicInstance().pan({x:t,y:e})},SvgPanZoom.prototype.centerAt=function(e){this.viewport.getViewBox();var t=this.width/2-e.x*this.getZoom(),e=this.height/2-e.y*this.getZoom();this.getPublicInstance().pan({x:t,y:e})},SvgPanZoom.prototype.updateBBox=function(){this.viewport.simpleViewBoxCache()},SvgPanZoom.prototype.pan=function(e){var t=this.viewport.getCTM();t.e=e.x,t.f=e.y,this.viewport.setCTM(t)},SvgPanZoom.prototype.panX=function(e){var t=this.viewport.getCTM();t.e=e,this.viewport.setCTM(t)},SvgPanZoom.prototype.panY=function(e){var t=this.viewport.getCTM();t.f=e,this.viewport.setCTM(t)},SvgPanZoom.prototype.panBy=function(e){var t=this.viewport.getCTM();t.e+=e.x,t.f+=e.y,this.viewport.setCTM(t)},SvgPanZoom.prototype.getPan=function(){var e=this.viewport.getState();return{x:e.x,y:e.y}},SvgPanZoom.prototype.resize=function(){var e=SvgUtils.getBoundingClientRectNormalized(this.svg),e=(this.width=e.width,this.height=e.height,this.viewport);e.options.width=this.width,e.options.height=this.height},SvgPanZoom.prototype.destroy=function(){var e,t=this;for(e in this.beforeZoom=null,this.onZoom=null,this.beforePan=null,this.onPan=null,(this.onUpdatedCTM=null)!=this.options.customEventsHandler&&this.options.customEventsHandler.destroy({svgElement:this.svg,eventsListenerElement:this.options.eventsListenerElement,instance:this.getPublicInstance()}),this.eventListeners)(this.options.eventsListenerElement||this.svg).removeEventListener(e,this.eventListeners[e],!this.options.preventMouseEventsDefault&&passiveListenerOption);this.disableMouseWheelZoom(),this.reset(),instancesStore=instancesStore.filter(function(e){return e.svg!==t.svg}),delete this.options,delete this.viewport,delete this.publicInstance,delete this.pi,this.getPublicInstance=function(){return null}},SvgPanZoom.prototype.getEventPoint=function(e,t){e=SvgUtils.getEventPoint(e,t).matrixTransform(t.getScreenCTM().inverse());return{x:e.x,y:e.y}},SvgPanZoom.prototype.getPublicInstance=function(){var n=this;return this.publicInstance||(this.publicInstance=this.pi={enablePan:function(){return n.options.panEnabled=!0,n.pi},disablePan:function(){return n.options.panEnabled=!1,n.pi},isPanEnabled:function(){return!!n.options.panEnabled},pan:function(e){return n.pan(e),n.pi},panX:function(e){return n.panX(e),n.pi},panY:function(e){return n.panY(e),n.pi},panBy:function(e){return n.panBy(e),n.pi},getPan:function(){return n.getPan()},setBeforePan:function(e){return n.options.beforePan=null===e?null:Utils.proxy(e,n.publicInstance),n.pi},setOnPan:function(e){return n.options.onPan=null===e?null:Utils.proxy(e,n.publicInstance),n.pi},enableZoom:function(){return n.options.zoomEnabled=!0,n.pi},disableZoom:function(){return n.options.zoomEnabled=!1,n.pi},isZoomEnabled:function(){return!!n.options.zoomEnabled},enableDblClickZoom:function(){return n.options.dblClickZoomEnabled=!0,n.pi},disableDblClickZoom:function(){return n.options.dblClickZoomEnabled=!1,n.pi},isDblClickZoomEnabled:function(){return!!n.options.dblClickZoomEnabled},enableMouseWheelZoom:function(){return n.enableMouseWheelZoom(),n.pi},disableMouseWheelZoom:function(){return n.disableMouseWheelZoom(),n.pi},isMouseWheelZoomEnabled:function(){return!!n.options.mouseWheelZoomEnabled},setZoomScaleSensitivity:function(e){return n.options.zoomScaleSensitivity=e,n.pi},getZoomScaleSensitivity:function(){return n.options.zoomScaleSensitivity},setMinZoom:function(e){return n.options.minZoom=e,n.pi},getMinZoom:function(){return n.options.minZoom},setMaxZoom:function(e){return n.options.maxZoom=e,n.pi},getMaxZoom:function(){return n.options.maxZoom},setBeforeZoom:function(e){return n.options.beforeZoom=null===e?null:Utils.proxy(e,n.publicInstance),n.pi},setOnZoom:function(e){return n.options.onZoom=null===e?null:Utils.proxy(e,n.publicInstance),n.pi},zoom:function(e){return n.publicZoom(e,!0),n.pi},zoomBy:function(e){return n.publicZoom(e,!1),n.pi},zoomAtPoint:function(e,t){return n.publicZoomAtPoint(e,t,!0),n.pi},zoomAtPointBy:function(e,t){return n.publicZoomAtPoint(e,t,!1),n.pi},zoomIn:function(){return this.zoomBy(1+n.options.zoomScaleSensitivity),n.pi},zoomOut:function(){return this.zoomBy(1/(1+n.options.zoomScaleSensitivity)),n.pi},getZoom:function(){return n.getRelativeZoom()},setOnUpdatedCTM:function(e){return n.options.onUpdatedCTM=null===e?null:Utils.proxy(e,n.publicInstance),n.pi},resetZoom:function(){return n.resetZoom(),n.pi},resetPan:function(){return n.resetPan(),n.pi},reset:function(){return n.reset(),n.pi},fit:function(){return n.fit(),n.pi},contain:function(){return n.contain(),n.pi},center:function(){return n.center(),n.pi},centerAt:function(e){return n.centerAt(e),n.pi},updateBBox:function(){return n.updateBBox(),n.pi},resize:function(){return n.resize(),n.pi},getSizes:function(){return{width:n.width,height:n.height,realZoom:n.getZoom(),viewBox:n.viewport.getViewBox()}},destroy:function(){return n.destroy(),n.pi},getEventPoint:function(e,t){return n.getEventPoint(e,t)}}),this.publicInstance},[]),svgPanZoomMain=function(e,t){var n=Utils.getSvg(e);if(null===n)return null;for(var i=instancesStore.length-1;0<=i;i--)if(instancesStore[i].svg===n)return instancesStore[i].instance.getPublicInstance();return instancesStore.push({svg:n,instance:new SvgPanZoom(n,t)}),instancesStore[instancesStore.length-1].instance.getPublicInstance()};class Ajax{static sync(e,t){let n=new XMLHttpRequest;if(n.open(e,t,!1),n.send(null),n.onerror=()=>{var e=`GET '${t}' failed,xhr.status=${n.status},xhr.statusText=${n.statusText}.`;throw new HuayouError(e,"Ajax.sync")},200==n.status)return n.responseText;throw e=`GET '${t}' failed,xhr.status=${n.status},xhr.statusText=${n.statusText}.`,new HuayouError(e,"Ajax.sync")}static async(e,t,n){let i=new XMLHttpRequest;i.open(e,t,!0),i.send(null),i.onerror=()=>{var e=`GET '${t}' failed,xhr.status=${i.status},xhr.statusText=${i.statusText}.`;throw new HuayouError(e,"Ajax.async")},i.onload=function(){n(i.responseText)}}}class SVGLoader{load(n,i){let o=this;Ajax.async("get",n,function(t){let e;try{e=o._parseFromString(t)}catch(e){throw o._parserSVGXml(t,n),new SVGParserError("Unknown exception. ","SVGLoader.load")}i(e)})}_parseFromString(e){var t=document.createElement("template"),e=(t.innerHTML=e,t.content.firstElementChild);if(e instanceof SVGSVGElement)return e;throw new Error}_parserSVGXml(t,n){t=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;if(t instanceof SVGSVGElement)return t;{let e;t=t.querySelector("parsererror");throw e=`The file obtained from '${n}' failed to parse correctly as an SVG document，`+`and the file contains the following errors: ${e=t?t.children[1].textContent.trim():"unknown error"}.`,new SVGParserError(e,"SVGLoader._parserSVGXml")}}}class Loader extends SVGLoader{constructor(){super()}loadSync(t){var n=Ajax.sync("get",t);try{return this._parseFromString(n)}catch(e){this._parserSVGXml(n,t)}}}class Defs extends Container{constructor(e){super();var t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new HuayouError(`0 or 1 argument required, but ${t} present.`,"Layers.constructor");Defs._valid(e)&&this._constructor_el(e)}this._nativeNode[Constants.ElementProxy]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new Defs:new Defs(e)}_createNativeNode(){var e=document.createElementNS(Constants.SvgNS,"defs");AttrDictHelper.setAttrTo(e,xmlSchema.defs.is,xmlSchema.defs.is.value),this._nativeNode=e}static _valid(t){try{if(!(t instanceof SVGDefsElement))throw new HuayouError("'element' must be of type SVGDefsElement.","Defs._valid",{code:1});var e,n=xmlSchema.defs,i=AttrDictHelper.getAttrFrom(t,n.is);if(null===i)throw o=`element must include '${n.is.xmlns.prefix}:${n.is.name}' `+"attribute!",new SVGParserError(o,"Defs._valid",{code:2});if(i===n.is.value)return!0;throw e=`The value of element '${n.is.xmlns.prefix}.${n.is.name}' `+`attribute must be '${n.is.value}',`,new SVGParserError(e,"Defs._valid",{code:3})}catch(e){var o=" element: "+t.cloneNode(!1).outerHTML;throw e.msg=e.msg+o,e}}static is(e){try{if(this._is(e))return!0}catch(e){return!1}}static _is(e){if(Defs._valid(e)){if(void 0!==e[Constants.ElementProxy]&&e[Constants.ElementProxy]instanceof Defs)return!0;throw new SVGParserError("The element is not associated with an instance of Defs. ","Defs._is")}}static cast(e){if(Defs._is(e))return e[Constants.ElementProxy]}}class Style extends Container{constructor(e){super();var t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new HuayouError(`0 or 1 argument required, but ${t} present.`,"Style.constructor");Style._valid(e)&&this._constructor_el(e)}this._nativeNode[Constants.ElementProxy]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new Style:new Style(e)}_createNativeNode(){var e=document.createElementNS(Constants.SvgNS,"style");AttrDictHelper.setAttrTo(e,xmlSchema.style.is,xmlSchema.style.is.value),this._nativeNode=e}static _valid(n){try{if(!(n instanceof SVGStyleElement))throw new HuayouError("'node' must be of type SVGStyleElement.","Style._valid",{code:1});var e,t,i=xmlSchema.style,o=AttrDictHelper.getAttrFrom(n,i.is);if(null===o)throw e=`element must include '${i.is.xmlns.prefix}:${i.is.name}' `+"attribute!",new SVGParserError(e,"Style._valid",{code:2});if(o===i.is.value)return!0;throw t=`The value of element '${i.is.xmlns.prefix}.${i.is.name}' `+`attribute must be '${i.is.value}',`,new SVGParserError(t,"Style._valid",{code:3})}catch(e){let t;throw t=n instanceof Element?" element: "+n.cloneNode(!1).outerHTML:" node: "+n.textContent,e.msg=e.msg+t,e}}static is(e){try{if(Style._is(e))return!0}catch(e){return!1}}static _is(e){if(Style._valid(e)){if(void 0!==e[Constants.ElementProxy]&&e[Constants.ElementProxy]instanceof Style)return!0;throw new SVGParserError("The element is not associated with an instance of Style. ","Style._is")}}static cast(e){if(Style._is(e))return e[Constants.ElementProxy]}get sheet(){return this.nativeNode.sheet}get disabled(){return this.nativeNode.disabled}set disabled(e){this.nativeNode.disabled=e}get media(){return this.nativeNode.media}set media(e){this.nativeNode.media=e}}class Metadata extends Container{constructor(e){super();var t=arguments.length;if(0==t)this._constructor();else{if(1!=t)throw new HuayouError(`0 or 1 argument required, but ${t} present.`,"Metadata.constructor");Metadata._valid(e)&&this._constructor_el(e)}this._nativeNode[Constants.ElementProxy]=this}_constructor(){this._createNativeNode()}_constructor_el(e){this._nativeNode=e}static _create(e){return 0==arguments.length?new Metadata:new Metadata(e)}_createNativeNode(){var e=document.createElementNS(Constants.SvgNS,"metadata");AttrDictHelper.setAttrTo(e,xmlSchema.metadata.is,xmlSchema.metadata.is.value),this._nativeNode=e}static _valid(t){try{if(!(t instanceof SVGMetadataElement))throw new HuayouError("'element' must be of type SVGMetadataElement.","Metadata._valid",{code:1});var e,n=xmlSchema.metadata,i=AttrDictHelper.getAttrFrom(t,n.is);if(null===i)throw o=`element must include '${n.is.xmlns.prefix}:${n.is.name}' `+"attribute!",new SVGParserError(o,"Metadata._valid",{code:2});if(i===n.is.value)return!0;throw e=`The value of element '${n.is.xmlns.prefix}.${n.is.name}' `+`attribute must be '${n.is.value}',`,new SVGParserError(e,"Metadata._valid",{code:3})}catch(e){var o=" element: "+t.cloneNode(!1).outerHTML;throw e.msg=e.msg+o,e}}static is(e){try{if(Metadata._is(e))return!0}catch(e){return!1}}static _is(e){if(Metadata._valid(e)){if(void 0!==e[Constants.ElementProxy]&&e[Constants.ElementProxy]instanceof Metadata)return!0;throw new SVGParserError("The element is not associated with an instance of Metadata. ","Metadata._is")}}static cast(e){if(Metadata._is(e))return e[Constants.ElementProxy]}}class BaseGraph{constructor(e){this._logger=Logger.getLogger("BaseGraph"),this._viewer=null,this._modeledSVG=null,this._topNodes=new ArrayList,this._metadata=null,this._style=null,this._defs=null,this._layers=null,this._svg=this._createSVG(),this._panZoom(this._svg),this._viewport=this._svg.querySelector(".svg-pan-zoom_viewport"),this._svg[Constants.CACHE_GRAPH]=this,void 0!==e&&this._importSVG(e),null==this._layers&&((e=new Layers).setGraph(this),this.getViewport().appendChild(e.nativeNode),this._layers=e,this._topNodes.add(e))}_createSVG(){var e,t=document.createElementNS(Constants.SvgNS,"svg"),n="_hyGraph_"+UUID.get();t.setAttribute("id",n),t.setAttributeNS(Constants.XmlnsNS,"xmlns:xlink","http://www.w3.org/1999/xlink"),t.style.display="block",t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.style.boxSizing="border-box",t.oncontextmenu=function(e){return!1},t.style.userSelect="none";for(e of xmlnsSet){if(null===e.prefix)throw new HuayouError("The xmlns.prefix of proporty 'xmlnsSet' of parameter 'configs' cannot be 'null'.","Viewer._createSVG");if(null===e.namespaceURI)throw new HuayouError("The xmlns.namespaceURI of proporty 'xmlnsSet' of parameter 'configs' cannot be 'null'.","Viewer._createSVG");t.setAttributeNS(Constants.XmlnsNS,"xmlns:"+e.prefix,e.namespaceURI)}return t}_panZoom(e){this._panZoomer=svgPanZoomMain(e,{viewportSelector:".svg-pan-zoom_viewport",zoomEnabled:!0,fit:!1,center:!1,contain:!1,minZoom:.05,maxZoom:50,preventMouseEventsDefault:!1})}_importSVG(e){if(!(e instanceof SVGSVGElement||"string"==typeof e))throw new HuayouError("'svg' must be of type 'string' or 'SVGSVGElement'.","Viewer.create");"string"==typeof e&&(e=(new Loader).loadSync(e)),this._fillGraph(e),this._modeledSVG=e.cloneNode(!1)}_fillGraph(e){this._copySVGAttrToGraph(e),this._moveElementsToGraph(e)}_copySVGAttrToGraph(e){var t=this._svg,e=CSS$1.removeAttrs(e.style.cssText,["width","height","x","y","position","top","left","bottom","right"]);t.style.cssText=e+";"+t.style.cssText}_moveElementsToGraph(e){this.getViewport();var t=e.children,n=t.length;for(let e=0;e<n;e++){var i,o=t[0];if(o instanceof SVGMetadataElement)this._moveMetadataToGraph(o);else if(o instanceof SVGStyleElement)this._moveStyleToGraph(o);else if(o instanceof SVGDefsElement)this._moveDefsToGraph(o);else if(o instanceof SVGGElement)this._moveLayersToGraph(o);else{if(!(o instanceof SVGDescElement))throw i=(i="All top-level elements in the SVG can only be <desc>,<metadata>,<style>,<defs> or <g>.")+(" illegal element: "+o.cloneNode(!1).outerHTML),new SVGParserError(i,"BaseGraph._moveElementsToGraph");this._moveDescToGraph(o)}}}_replaceSVGScriptElement(e){var t=e.getAttribute("src")||e.getAttribute("href"),n=document.createElement("script");return n.type=e.getAttribute("type")||"text/javascript",null==t?n.text=e.innerHTML:n.src=t,e.remove(),n}_moveDescToGraph(e){this.getViewport().insertAdjacentElement("beforebegin",e)}_moveMetadataToGraph(e){var t;if(null!=this._metadata)throw t=(t="All top-level elements in the SVG, can only there one <metadata> element .")+(" illegal element: "+e.cloneNode(!1).outerHTML+"."),new SVGParserError(t,"BaseGraph._moveMetadataToGraph");(t=Metadata._create(e)).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._metadata=t,this._topNodes.add(t)}_moveStyleToGraph(e){var t;if(null!=this._style)throw t=(t="All top-level elements in the SVG, can only there one <style> element .")+(" illegal element: "+e.cloneNode(!1).outerHTML+"."),new SVGParserError(t,"BaseGraph._moveStyleToGraph");(t=Style._create(e)).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._style=t,this._topNodes.add(t)}_moveDefsToGraph(e){var t;if(null!=this._defs)throw t=(t="All top-level elements in the SVG, can only there one <defs> element .")+(" illegal element: "+e.cloneNode(!1).outerHTML+"."),new SVGParserError(t,"BaseGraph._moveDefsToGraph");(t=Defs._create(e)).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",t.nativeNode),this._defs=t,this._topNodes.add(t)}_moveLayersToGraph(e){if(null!=this._layers)throw t=(t='All top-level elements in the SVG, can only there one <g is="Layers"> element .')+(" illegal element: "+e.cloneNode(!1).outerHTML+"."),new SVGParserError(t,"BaseGraph._moveLayersToGraph");var t=e.cloneNode(!1),n=new Layers(t),i=(n.setGraph(this),e.children),o=i.length;for(let e=0;e<o;e++){var r=i[0],r=new Layer(r);n.add(r)}e.remove(),this.getViewport().appendChild(n.nativeNode),this._layers=n,this._topNodes.add(n)}_getPanZoomer(){return this._panZoomer}_getSVG(){return this._svg}getModeledSVG(){return this._modeledSVG}getViewport(){return this._viewport}get viewer(){return this._viewer}get layers(){return this._layers}get metadata(){var e;return null==this._metadata&&((e=Metadata._create()).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._metadata=e,this._topNodes.add(e)),this._metadata}get style(){var e;return null==this._style&&((e=Style._create()).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._style=e,this._topNodes.add(e)),this._style}get defs(){var e;return null==this._defs&&((e=Defs._create()).setGraph(this),this.getViewport().insertAdjacentElement("beforebegin",e.nativeNode),this._defs=e,this._topNodes.add(e)),this._defs}}class Graph extends BaseGraph{constructor(e){super(e)}getElementById(t){if(void 0!==t){var n="#"+CSS.escape(t);let e=null;for(const i of this._topNodes.values())if(null!==(e=i.querySelector(n)))return e;return e}}querySelector(e){let t=null;for(const n of this._topNodes.values())if(null!==(t=n.querySelector(e)))return t;return t}querySelectorAll(e){let t=new Array;for(const i of this._topNodes.values()){var n=i.querySelectorAll(e);0<n.length&&(t=t.concat(n))}return t}getElementsByTagName(e){let t=new Array;for(const i of this._topNodes.values()){var n=i.getElementsByTagName(e);0<n.length&&(t=t.concat(n))}return t}getElementsByClassName(e){let t=new Array;for(const i of this._topNodes.values()){var n=i.getElementsByClassName(e);0<n.length&&(t=t.concat(n))}return t}}class Size{constructor(e,t){this._width=e,this._height=t}set width(e){this._width=e}get width(){return this._width}set height(e){this._height=e}get height(){return this._height}}class Point{constructor(e,t){this._x=e,this._y=t}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}}class Box{constructor(e,t,n,i){this._x=e,this._y=t,this._width=n,this._height=i}get x(){return this._x}get y(){return this._y}get width(){return this._width}get height(){return this._height}}class Viewer{constructor(e,t){this._logger=new Logger("Viewer"),this._graph=null,this._eventListener={},this._listenerAnonym="_anonym",this._EventType={RESIZE:"resize",PANSTART:"panstart",PANEND:"panend",ZOOMSTART:"zoomstart",ZOOMEND:"zoomend",CLICK:"click",CONTEXTMENU:"contextmenu",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEUP:"mouseup"},this._resizeEvent={},this._resizeIsfirst=!0;var n=arguments.length;if(2!=n)throw new HuayouError(`2 argument required, but  ${n} present.`,"Viewer.constructor");if("string"==typeof e){if(this._container=document.getElementById(e),null===this._container)throw new HuayouError(`Element with id='${e}'  not found,`,"Viewer.constructor")}else{if(!(e instanceof HTMLDivElement))throw new HuayouError("'svg' must be of type 'string' or 'HTMLDivElement'.","Viewer.constructor");this._container=e}if(!(t instanceof Graph))throw new HuayouError("'graph' must be of type  'Graph'.","Viewer.constructor");((this._graph=t)._viewer=this)._constructor()}_constructor(){var e=this._createInnerContainer();this._container.appendChild(e),this._shadowRoot=e.attachShadow({mode:"closed"}),this._svg=this.graph._getSVG(),this._shadowRoot.appendChild(this._svg),this._panZoomer=this.graph._getPanZoomer(),this._panZoomer.resize(),this._listenSvgResize(this._svg)}_createInnerContainer(){var e=document.createElement("div");return e.id=UUID.get(),e.style.width="100%",e.style.height="100%",this._innnerContainer=e}_listenSvgResize(e){this._resizeInitWidth=this._innnerContainer.clientWidth,this._resizefInitHeight=this._innnerContainer.clientHeight,this._resizeEvent.oldWidth=this.width,this._resizeEvent.oldHeight=this.height;var t=new ResizeObserver(e=>{e.forEach(e=>{this._onSvgResize(e)})});t.observe(this._innnerContainer),this._resizeObserver=t}_onSvgResize(e){var t,n;this._resizeIsfirst&&(this._resizeIsfirst=!1,t=e.target.clientWidth,n=e.target.clientHeight,this._resizeInitWidth==t)&&this._resizefInitHeight==n||this._ResizeCallback(e)}_ResizeCallback(e){if(this._panZoomer.resize(),this._EventType.RESIZE in this._eventListener){var t,n={type:this._EventType.RESIZE,target:this,currentTarget:this,event:null,oldSize:new Size(this._resizeEvent.oldWidth,this._resizeEvent.oldHeight),newSize:new Size(this.width,this.height)},i=(this._resizeEvent.oldWidth=this.width,this._resizeEvent.oldHeight=this.height,this._eventListener[this._EventType.RESIZE]);for(t of i)t(n)}}_css(e,t){return 0===arguments.length?CSS$1.style(this._svg):1===arguments.length?CSS$1.style(this._svg,e):2===arguments.length?CSS$1.style(this._svg,e,t):void 0}get container(){return this._container}get graph(){return this._graph}get width(){return this._panZoomer.getSizes().width}get height(){return this._panZoomer.getSizes().height}set border(e){this._css("border",e)}get border(){return this._css("border")}set background(e){this._css("background",e)}get background(){return this._css("background")}set stopContextmenu(e){var t=this._svg;t.oncontextmenu=e?function(e){return!1}:null}get stopContextmenu(){return null!=this._svg.oncontextmenu}set draggable(e){e?this._panZoomer.enablePan():this._panZoomer.disablePan()}get draggable(){return this._panZoomer.isPanEnabled()}set dblClickZoomEnabled(e){e?this._panZoomer.enableDblClickZoom():this._panZoomer.disableDblClickZoom()}get dblClickZoomEnabled(){return this._panZoomer.isDblClickZoomEnabled()}set mouseWheelZoomEnabled(e){e?this._panZoomer.enableMouseWheelZoom():this._panZoomer.disableMouseWheelZoom()}get mouseWheelZoomEnabled(){return this._panZoomer.isMouseWheelZoomEnabled()}set zoomSensitivity(e){this._panZoomer.setZoomScaleSensitivity(e)}get zoomSensitivity(){return this._panZoomer.getZoomScaleSensitivity()}set minZoom(e){this._panZoomer.setMinZoom(e)}get minZoom(){return this._panZoomer.getMinZoom()}set maxZoom(e){this._panZoomer.setMaxZoom(e)}get maxZoom(){return this._panZoomer.getMaxZoom()}pan(e,t){if(1==arguments.length)this._panZoomer.pan({x:e,y:e});else{if(2!=arguments.length)throw new HuayouError(`1 or 2 argument required, but ${arguments.length} present.`,"Viewer.pan");this._panZoomer.pan({x:e,y:t})}}panX(e){this._panZoomer.panX(e)}panY(e){this._panZoomer.panY(e)}panOn(e,t){if(1==arguments.length)this._panZoomer.panBy({x:e,y:e});else{if(2!=arguments.length)throw new HuayouError(`1 or 2 argument required, but ${arguments.length} present.`,"Viewer.panOn");this._panZoomer.panBy({x:e,y:t})}}panXOn(e){this._panZoomer.panBy({x:e,y:0})}panYOn(e){this._panZoomer.panBy({x:0,y:e})}center(e){var t;void 0===e?this._panZoomer.center():((t=this._svg.createSVGPoint()).x=e.x,t.y=e.y,this._panZoomer.centerAt(t))}getCurrentPan(){return this._panZoomer.getPan()}resetPan(){this._panZoomer.resetPan()}zoom(e,t){if(1==arguments.length)this._panZoomer.zoom(e);else{if(2!=arguments.length)throw new HuayouError(`1 or 2 argument required, but  ${arguments.length} present.`,"Viewer.zoom");var n=this._svg.createSVGPoint();n.x=t.x,n.y=t.y,this._panZoomer.zoomAtPoint(e,n)}}zoomIn(){this._panZoomer.zoomIn()}zoomOut(){this._panZoomer.zoomOut()}zoomOn(e,t){if(1===arguments.length)this._panZoomer.zoomBy(e);else{if(2!==arguments.length)throw new HuayouError(`1 or 2 argument required, but  ${arguments.length} present.`,"Viewer.zoomOn");var n=this._svg.createSVGPoint();n.x=t.x,n.y=t.y,this._panZoomer.zoomAtPointBy(e,n)}}getCurrentZoom(){return this._panZoomer.getZoom()}resetZoom(){this._panZoomer.resetZoom()}fit(){this._panZoomer.fit()}contain(){this._panZoomer.contain()}zoomFull(){this._panZoomer.fit(),this._panZoomer.center()}zoomBox(e,t){var n=this.width/t.width,i=this.height/t.height,i=i<n?i:n,n=new Point(e.x+t.width/2,e.y+t.height/2),e=(this.zoomOn(i,n),this.width/2-n.x),t=this.height/2-n.y;this.panOn(e,t)}toVCS(e){var t=this.getCurrentPan(),n=this.getCurrentZoom(),i=e.x*n+t.x,e=e.y*n+t.y;return new Point(i,e)}toUCS(e){var t=this.getCurrentPan(),n=this.getCurrentZoom(),i=(e.x-t.x)/n,e=(e.y-t.y)/n;return new Point(i,e)}reset(){this._panZoomer.resetZoom(),this._panZoomer.resetPan()}getBBox(){var e=this._panZoomer.getSizes().viewBox;return new Box(e.x,e.y,e.width,e.height)}saveAs(e){this._svg}addEventListener(e,i){var t=e.toLowerCase();switch(t){case this._EventType.RESIZE:t in this._eventListener?(o=this._eventListener[t]).has(i)?this._logger.warn("The callback for this event type is already registered."):o.add(i):((o=new Set).add(i),this._eventListener[t]=o);break;case this._EventType.PANSTART:case this._EventType.PANEND:case this._EventType.ZOOMSTART:case this._EventType.ZOOMEND:let n={type:t,target:this,currentTarget:this,event:null};t==this._EventType.PANSTART&&this._panZoomer.setBeforePan((e,t)=>(n.oldPan=e,n.newPan=t,i(n))),t==this._EventType.PANEND&&this._panZoomer.setOnPan(e=>{n.pan=e,i(n)}),t==this._EventType.ZOOMSTART&&this._panZoomer.setBeforeZoom((e,t)=>(n.oldZoom=e,n.newZoom=t,i(n))),t==this._EventType.ZOOMEND&&this._panZoomer.setOnZoom(e=>{n.zoom=e,i(n)});break;default:var o=t+this._listenerAnonym,r=e=>{this._eventHandler(e,i)};if(t in this._eventListener){var s=this._eventListener[t];if(s.has(i)){this._logger.warn("The callback for this event type is already registered");break}s.add(i),this._eventListener[o].set(i,r)}else{s=new Set,s=(s.add(i),this._eventListener[t]=s,new Map);s.set(i,r),this._eventListener[o]=s}this._svg.addEventListener(e,r)}}_eventHandler(e,t){var n=e.target instanceof SVGSVGElement?this:e.target,i={type:e.type,target:n,currentTarget:this,event:e};switch(e.type){case this._EventType.CLICK:case this._EventType.CONTEXTMENU:case this._EventType.DBLCLICK:case this._EventType.MOUSEDOWN:case this._EventType.MOUSEMOVE:case this._EventType.MOUSEUP:var o=this._panZoomer.getEventPoint(e,this._svg);i.point=o}t(i)}removeEventListener(e,t){var n,i,o,r,s=e.toLowerCase();switch(s){case this._EventType.RESIZE:s in this._eventListener&&(n=this._eventListener[s]).has(t)&&(n.delete(t),0==n.size)&&delete this._eventListener[s];break;case this._EventType.PANSTART:case this._EventType.PANEND:case this._EventType.ZOOMSTART:case this._EventType.ZOOMEND:s==this._EventType.PANSTART&&this._panZoomer.setBeforePan(null),s==this._EventType.PANEND&&this._panZoomer.setOnPan(null),s==this._EventType.ZOOMSTART&&this._panZoomer.setBeforeZoom(null),s==this._EventType.ZOOMEND&&this._panZoomer.setOnZoom(null);break;default:s in this._eventListener&&(n=s+this._listenerAnonym,(i=this._eventListener[s]).has(t))&&(i.delete(t),r=(o=this._eventListener[n]).get(t),this._svg.removeEventListener(e,r),o.delete(t),0==i.size)&&(delete this._eventListener[s],delete this._eventListener[n])}}destroy(){this._resizeObserver.unobserve(this._innnerContainer),this._panZoomer.destroy(),this.container.removeChild(this._innnerContainer);for(var e=Object.keys(this),t=0;t<e.length;t++)delete this[e[t]]}}class Vector{constructor(e,t){this._x=e,this._y=t}set x(e){this._x=e}get x(){return this._x}set y(e){this._y=e}get y(){return this._y}}const Huayou={Viewer:Viewer,Graph:Graph,Layers:Layers,Layer:Layer,Style:Style,Defs:Defs,Metadata:Metadata,SVGLoader:SVGLoader,Point:Point,Size:Size,Box:Box,Vector:Vector,Error:HuayouError,SVGParserError:SVGParserError};export{Huayou as default};

